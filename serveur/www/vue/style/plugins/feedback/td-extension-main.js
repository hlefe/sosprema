/*!  - v1454682960113 */window.TrackDuck=window.parent.TrackDuck,function(){var io=this.io={};if(function(a,b){var c=a;c.version="0.9.16",c.protocol=1,c.transports=[],c.j=[],c.sockets={},c.connect=function(a,d){var e,f,g=c.util.parseUri(a);b&&b.location&&(g.protocol=g.protocol||b.location.protocol.slice(0,-1),g.host=g.host||(b.document?b.document.domain:b.location.hostname),g.port=g.port||b.location.port),e=c.util.uniqueUri(g);var h={host:g.host,secure:"https"==g.protocol,port:g.port||("https"==g.protocol?443:80),query:g.query||""};return c.util.merge(h,d),(h["force new connection"]||!c.sockets[e])&&(f=new c.Socket(h)),!h["force new connection"]&&f&&(c.sockets[e]=f),f=f||c.sockets[e],f.of(g.path.length>1?g.path:"")}}(this.io,window),function(a,b){var c=a.util={},d=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];c.parseUri=function(a){for(var b=d.exec(a||""),c={},f=14;f--;)c[e[f]]=b[f]||"";return c},c.uniqueUri=function(a){var c=a.protocol,d=a.host,e=a.port;return"document"in b?(d=d||document.domain,e=e||("https"==c&&"https:"!==document.location.protocol?443:document.location.port)):(d=d||"localhost",e||"https"!=c||(e=443)),(c||"http")+"://"+d+":"+(e||80)},c.query=function(a,b){var d=c.chunkQuery(a||""),e=[];c.merge(d,c.chunkQuery(b||""));for(var f in d)d.hasOwnProperty(f)&&e.push(f+"="+d[f]);return e.length?"?"+e.join("&"):""},c.chunkQuery=function(a){for(var b,c={},d=a.split("&"),e=0,f=d.length;f>e;++e)b=d[e].split("="),b[0]&&(c[b[0]]=b[1]);return c};var f=!1;c.load=function(a){return"document"in b&&"complete"===document.readyState||f?a():void c.on(b,"load",a,!1)},c.on=function(a,b,c,d){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener&&a.addEventListener(b,c,d)},c.request=function(a){if(a&&"undefined"!=typeof XDomainRequest&&!c.ua.hasCORS)return new XDomainRequest;if("undefined"!=typeof XMLHttpRequest&&(!a||c.ua.hasCORS))return new XMLHttpRequest;if(!a)try{return new(window[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(b){}return null},"undefined"!=typeof window&&c.load(function(){f=!0}),c.defer=function(a){return c.ua.webkit&&"undefined"==typeof importScripts?void c.load(function(){setTimeout(a,100)}):a()},c.merge=function(a,b,d,e){var f,g=e||[],h="undefined"==typeof d?2:d;for(f in b)b.hasOwnProperty(f)&&c.indexOf(g,f)<0&&("object"==typeof a[f]&&h?c.merge(a[f],b[f],h-1,g):(a[f]=b[f],g.push(b[f])));return a},c.mixin=function(a,b){c.merge(a.prototype,b.prototype)},c.inherit=function(a,b){function c(){}c.prototype=b.prototype,a.prototype=new c},c.isArray=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)},c.intersect=function(a,b){for(var d=[],e=a.length>b.length?a:b,f=a.length>b.length?b:a,g=0,h=f.length;h>g;g++)~c.indexOf(e,f[g])&&d.push(f[g]);return d},c.indexOf=function(a,b,c){for(var d=a.length,c=0>c?0>c+d?0:c+d:c||0;d>c&&a[c]!==b;c++);return c>=d?-1:c},c.toArray=function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c]);return b},c.ua={},c.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){try{var a=new XMLHttpRequest}catch(b){return!1}return void 0!=a.withCredentials}(),c.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),c.ua.iDevice="undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)}(this.io,window),function(a,b){function c(){}a.EventEmitter=c,c.prototype.on=function(a,c){return this.$events||(this.$events={}),this.$events[a]?b.util.isArray(this.$events[a])?this.$events[a].push(c):this.$events[a]=[this.$events[a],c]:this.$events[a]=c,this},c.prototype.addListener=c.prototype.on,c.prototype.once=function(a,b){function c(){d.removeListener(a,c),b.apply(this,arguments)}var d=this;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,c){if(this.$events&&this.$events[a]){var d=this.$events[a];if(b.util.isArray(d)){for(var e=-1,f=0,g=d.length;g>f;f++)if(d[f]===c||d[f].listener&&d[f].listener===c){e=f;break}if(0>e)return this;d.splice(e,1),d.length||delete this.$events[a]}else(d===c||d.listener&&d.listener===c)&&delete this.$events[a]}return this},c.prototype.removeAllListeners=function(a){return void 0===a?(this.$events={},this):(this.$events&&this.$events[a]&&(this.$events[a]=null),this)},c.prototype.listeners=function(a){return this.$events||(this.$events={}),this.$events[a]||(this.$events[a]=[]),b.util.isArray(this.$events[a])||(this.$events[a]=[this.$events[a]]),this.$events[a]},c.prototype.emit=function(a){if(!this.$events)return!1;var c=this.$events[a];if(!c)return!1;var d=Array.prototype.slice.call(arguments,1);if("function"==typeof c)c.apply(this,d);else{if(!b.util.isArray(c))return!1;for(var e=c.slice(),f=0,g=e.length;g>f;f++)e[f].apply(this,d)}return!0}}(this.io,this.io),function(exports,nativeJSON){"use strict";function f(a){return 10>a?"0"+a:a}function date(a){return isFinite(a.valueOf())?a.getUTCFullYear()+"-"+f(a.getUTCMonth()+1)+"-"+f(a.getUTCDate())+"T"+f(a.getUTCHours())+":"+f(a.getUTCMinutes())+":"+f(a.getUTCSeconds())+"Z":null}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i instanceof Date&&(i=date(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;f>c;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;f>c;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}if(nativeJSON&&nativeJSON.parse)return exports.JSON={parse:nativeJSON.parse,stringify:nativeJSON.stringify};var JSON=exports.JSON={},cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;c>d;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})},JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")}}(this.io,"undefined"!=typeof JSON?JSON:void 0),function(a,b){var c=a.parser={},d=c.packets=["disconnect","connect","heartbeat","message","json","event","ack","error","noop"],e=c.reasons=["transport not supported","client not handshaken","unauthorized"],f=c.advice=["reconnect"],g=b.JSON,h=b.util.indexOf;c.encodePacket=function(a){var b=h(d,a.type),c=a.id||"",i=a.endpoint||"",j=a.ack,k=null;switch(a.type){case"error":var l=a.reason?h(e,a.reason):"",m=a.advice?h(f,a.advice):"";(""!==l||""!==m)&&(k=l+(""!==m?"+"+m:""));break;case"message":""!==a.data&&(k=a.data);break;case"event":var n={name:a.name};a.args&&a.args.length&&(n.args=a.args),k=g.stringify(n);break;case"json":k=g.stringify(a.data);break;case"connect":a.qs&&(k=a.qs);break;case"ack":k=a.ackId+(a.args&&a.args.length?"+"+g.stringify(a.args):"")}var o=[b,c+("data"==j?"+":""),i];return null!==k&&void 0!==k&&o.push(k),o.join(":")},c.encodePayload=function(a){var b="";if(1==a.length)return a[0];for(var c=0,d=a.length;d>c;c++){var e=a[c];b+="�"+e.length+"�"+a[c]}return b};var i=/([^:]+):([0-9]+)?(\+)?:([^:]+)?:?([\s\S]*)?/;c.decodePacket=function(a){var b=a.match(i);if(!b)return{};var c=b[2]||"",a=b[5]||"",h={type:d[b[1]],endpoint:b[4]||""};switch(c&&(h.id=c,h.ack=b[3]?"data":!0),h.type){case"error":var b=a.split("+");h.reason=e[b[0]]||"",h.advice=f[b[1]]||"";break;case"message":h.data=a||"";break;case"event":try{var j=g.parse(a);h.name=j.name,h.args=j.args}catch(k){}h.args=h.args||[];break;case"json":try{h.data=g.parse(a)}catch(k){}break;case"connect":h.qs=a||"";break;case"ack":var b=a.match(/^([0-9]+)(\+)?(.*)/);if(b&&(h.ackId=b[1],h.args=[],b[3]))try{h.args=b[3]?g.parse(b[3]):[]}catch(k){}break;case"disconnect":case"heartbeat":}return h},c.decodePayload=function(a){if("�"==a.charAt(0)){for(var b=[],d=1,e="";d<a.length;d++)"�"==a.charAt(d)?(b.push(c.decodePacket(a.substr(d+1).substr(0,e))),d+=Number(e)+1,e=""):e+=a.charAt(d);return b}return[c.decodePacket(a)]}}(this.io,this.io),function(a,b){function c(a,b){this.socket=a,this.sessid=b}a.Transport=c,b.util.mixin(c,b.EventEmitter),c.prototype.heartbeats=function(){return!0},c.prototype.onData=function(a){if(this.clearCloseTimeout(),(this.socket.connected||this.socket.connecting||this.socket.reconnecting)&&this.setCloseTimeout(),""!==a){var c=b.parser.decodePayload(a);if(c&&c.length)for(var d=0,e=c.length;e>d;d++)this.onPacket(c[d])}return this},c.prototype.onPacket=function(a){return this.socket.setHeartbeatTimeout(),"heartbeat"==a.type?this.onHeartbeat():("connect"==a.type&&""==a.endpoint&&this.onConnect(),"error"==a.type&&"reconnect"==a.advice&&(this.isOpen=!1),this.socket.onPacket(a),this)},c.prototype.setCloseTimeout=function(){if(!this.closeTimeout){var a=this;this.closeTimeout=setTimeout(function(){a.onDisconnect()},this.socket.closeTimeout)}},c.prototype.onDisconnect=function(){return this.isOpen&&this.close(),this.clearTimeouts(),this.socket.onDisconnect(),this},c.prototype.onConnect=function(){return this.socket.onConnect(),this},c.prototype.clearCloseTimeout=function(){this.closeTimeout&&(clearTimeout(this.closeTimeout),this.closeTimeout=null)},c.prototype.clearTimeouts=function(){this.clearCloseTimeout(),this.reopenTimeout&&clearTimeout(this.reopenTimeout)},c.prototype.packet=function(a){this.send(b.parser.encodePacket(a))},c.prototype.onHeartbeat=function(){this.packet({type:"heartbeat"})},c.prototype.onOpen=function(){this.isOpen=!0,this.clearCloseTimeout(),this.socket.onOpen()},c.prototype.onClose=function(){this.isOpen=!1,this.socket.onClose(),this.onDisconnect()},c.prototype.prepareUrl=function(){var a=this.socket.options;return this.scheme()+"://"+a.host+":"+a.port+"/"+a.resource+"/"+b.protocol+"/"+this.name+"/"+this.sessid},c.prototype.ready=function(a,b){b.call(this)}}(this.io,this.io),function(a,b,c){function d(a){if(this.options={port:80,secure:!1,document:"document"in c?document:!1,resource:"socket.io",transports:b.transports,"connect timeout":1e4,"try multiple transports":!0,reconnect:!0,"reconnection delay":500,"reconnection limit":1/0,"reopen delay":3e3,"max reconnection attempts":10,"sync disconnect on unload":!1,"auto connect":!0,"flash policy port":10843,manualFlush:!1},b.util.merge(this.options,a),this.connected=!1,this.open=!1,this.connecting=!1,this.reconnecting=!1,this.namespaces={},this.buffer=[],this.doBuffer=!1,this.options["sync disconnect on unload"]&&(!this.isXDomain()||b.util.ua.hasCORS)){var d=this;b.util.on(c,"beforeunload",function(){d.disconnectSync()},!1)}this.options["auto connect"]&&this.connect()}function e(){}a.Socket=d,b.util.mixin(d,b.EventEmitter),d.prototype.of=function(a){return this.namespaces[a]||(this.namespaces[a]=new b.SocketNamespace(this,a),""!==a&&this.namespaces[a].packet({type:"connect"})),this.namespaces[a]},d.prototype.publish=function(){this.emit.apply(this,arguments);var a;for(var b in this.namespaces)this.namespaces.hasOwnProperty(b)&&(a=this.of(b),a.$emit.apply(a,arguments))},d.prototype.handshake=function(a){function c(b){b instanceof Error?(d.connecting=!1,d.onError(b.message)):a.apply(null,b.split(":"))}var d=this,f=this.options,g=["http"+(f.secure?"s":"")+":/",f.host+":"+f.port,f.resource,b.protocol,b.util.query(this.options.query,"t="+ +new Date)].join("/");if(this.isXDomain()&&!b.util.ua.hasCORS){var h=document.getElementsByTagName("script")[0],i=document.createElement("script");i.src=g+"&jsonp="+b.j.length,h.parentNode.insertBefore(i,h),b.j.push(function(a){c(a),i.parentNode.removeChild(i)})}else{var j=b.util.request();j.open("GET",g,!0),this.isXDomain()&&(j.withCredentials=!0),j.onreadystatechange=function(){4==j.readyState&&(j.onreadystatechange=e,200==j.status?c(j.responseText):403==j.status?d.onError(j.responseText):(d.connecting=!1,!d.reconnecting&&d.onError(j.responseText)))},j.send(null)}},d.prototype.getTransport=function(a){for(var c,d=a||this.transports,e=0;c=d[e];e++)if(b.Transport[c]&&b.Transport[c].check(this)&&(!this.isXDomain()||b.Transport[c].xdomainCheck(this)))return new b.Transport[c](this,this.sessionid);return null},d.prototype.connect=function(a){if(this.connecting)return this;var c=this;return c.connecting=!0,this.handshake(function(d,e,f,g){function h(a){return c.transport&&c.transport.clearTimeouts(),c.transport=c.getTransport(a),c.transport?void c.transport.ready(c,function(){c.connecting=!0,c.publish("connecting",c.transport.name),c.transport.open(),c.options["connect timeout"]&&(c.connectTimeoutTimer=setTimeout(function(){if(!c.connected&&(c.connecting=!1,c.options["try multiple transports"])){for(var a=c.transports;a.length>0&&a.splice(0,1)[0]!=c.transport.name;);a.length?h(a):c.publish("connect_failed")}},c.options["connect timeout"]))}):c.publish("connect_failed")}c.sessionid=d,c.closeTimeout=1e3*f,c.heartbeatTimeout=1e3*e,c.transports||(c.transports=c.origTransports=g?b.util.intersect(g.split(","),c.options.transports):c.options.transports),c.setHeartbeatTimeout(),h(c.transports),c.once("connect",function(){clearTimeout(c.connectTimeoutTimer),a&&"function"==typeof a&&a()})}),this},d.prototype.setHeartbeatTimeout=function(){if(clearTimeout(this.heartbeatTimeoutTimer),!this.transport||this.transport.heartbeats()){var a=this;this.heartbeatTimeoutTimer=setTimeout(function(){a.transport.onClose()},this.heartbeatTimeout)}},d.prototype.packet=function(a){return this.connected&&!this.doBuffer?this.transport.packet(a):this.buffer.push(a),this},d.prototype.setBuffer=function(a){this.doBuffer=a,!a&&this.connected&&this.buffer.length&&(this.options.manualFlush||this.flushBuffer())},d.prototype.flushBuffer=function(){this.transport.payload(this.buffer),this.buffer=[]},d.prototype.disconnect=function(){return(this.connected||this.connecting)&&(this.open&&this.of("").packet({type:"disconnect"}),this.onDisconnect("booted")),this},d.prototype.disconnectSync=function(){var a=b.util.request(),c=["http"+(this.options.secure?"s":"")+":/",this.options.host+":"+this.options.port,this.options.resource,b.protocol,"",this.sessionid].join("/")+"/?disconnect=1";a.open("GET",c,!1),a.send(null),this.onDisconnect("booted")},d.prototype.isXDomain=function(){var a=c.location.port||("https:"==c.location.protocol?443:80);return this.options.host!==c.location.hostname||this.options.port!=a},d.prototype.onConnect=function(){this.connected||(this.connected=!0,this.connecting=!1,this.doBuffer||this.setBuffer(!1),this.emit("connect"))},d.prototype.onOpen=function(){this.open=!0},d.prototype.onClose=function(){this.open=!1,clearTimeout(this.heartbeatTimeoutTimer)},d.prototype.onPacket=function(a){this.of(a.endpoint).onPacket(a)},d.prototype.onError=function(a){a&&a.advice&&"reconnect"===a.advice&&(this.connected||this.connecting)&&(this.disconnect(),this.options.reconnect&&this.reconnect()),this.publish("error",a&&a.reason?a.reason:a)},d.prototype.onDisconnect=function(a){var b=this.connected,c=this.connecting;this.connected=!1,this.connecting=!1,this.open=!1,(b||c)&&(this.transport.close(),this.transport.clearTimeouts(),b&&(this.publish("disconnect",a),"booted"!=a&&this.options.reconnect&&!this.reconnecting&&this.reconnect()))},d.prototype.reconnect=function(){function a(){if(c.connected){for(var a in c.namespaces)c.namespaces.hasOwnProperty(a)&&""!==a&&c.namespaces[a].packet({type:"connect"});c.publish("reconnect",c.transport.name,c.reconnectionAttempts)}clearTimeout(c.reconnectionTimer),c.removeListener("connect_failed",b),c.removeListener("connect",b),c.reconnecting=!1,delete c.reconnectionAttempts,delete c.reconnectionDelay,delete c.reconnectionTimer,delete c.redoTransports,c.options["try multiple transports"]=e}function b(){return c.reconnecting?c.connected?a():c.connecting&&c.reconnecting?c.reconnectionTimer=setTimeout(b,1e3):void(c.reconnectionAttempts++>=d?c.redoTransports?(c.publish("reconnect_failed"),a()):(c.on("connect_failed",b),c.options["try multiple transports"]=!0,c.transports=c.origTransports,c.transport=c.getTransport(),c.redoTransports=!0,c.connect()):(c.reconnectionDelay<f&&(c.reconnectionDelay*=2),c.connect(),c.publish("reconnecting",c.reconnectionDelay,c.reconnectionAttempts),c.reconnectionTimer=setTimeout(b,c.reconnectionDelay))):void 0}this.reconnecting=!0,this.reconnectionAttempts=0,this.reconnectionDelay=this.options["reconnection delay"];var c=this,d=this.options["max reconnection attempts"],e=this.options["try multiple transports"],f=this.options["reconnection limit"];this.options["try multiple transports"]=!1,this.reconnectionTimer=setTimeout(b,this.reconnectionDelay),this.on("connect",b)}}(this.io,this.io,window),function(a,b){function c(a,b){this.socket=a,this.name=b||"",this.flags={},this.json=new d(this,"json"),this.ackPackets=0,this.acks={}}function d(a,b){this.namespace=a,this.name=b}a.SocketNamespace=c,b.util.mixin(c,b.EventEmitter),c.prototype.$emit=b.EventEmitter.prototype.emit,c.prototype.of=function(){return this.socket.of.apply(this.socket,arguments)},c.prototype.packet=function(a){return a.endpoint=this.name,this.socket.packet(a),this.flags={},this},c.prototype.send=function(a,b){var c={type:this.flags.json?"json":"message",data:a};return"function"==typeof b&&(c.id=++this.ackPackets,c.ack=!0,this.acks[c.id]=b),this.packet(c)},c.prototype.emit=function(a){var b=Array.prototype.slice.call(arguments,1),c=b[b.length-1],d={type:"event",name:a};return"function"==typeof c&&(d.id=++this.ackPackets,d.ack="data",this.acks[d.id]=c,b=b.slice(0,b.length-1)),d.args=b,this.packet(d)},c.prototype.disconnect=function(){return""===this.name?this.socket.disconnect():(this.packet({type:"disconnect"}),this.$emit("disconnect")),this},c.prototype.onPacket=function(a){function c(){d.packet({type:"ack",args:b.util.toArray(arguments),ackId:a.id})}var d=this;switch(a.type){case"connect":this.$emit("connect");break;case"disconnect":""===this.name?this.socket.onDisconnect(a.reason||"booted"):this.$emit("disconnect",a.reason);break;case"message":case"json":var e=["message",a.data];"data"==a.ack?e.push(c):a.ack&&this.packet({type:"ack",ackId:a.id}),this.$emit.apply(this,e);break;case"event":var e=[a.name].concat(a.args);"data"==a.ack&&e.push(c),this.$emit.apply(this,e);break;case"ack":this.acks[a.ackId]&&(this.acks[a.ackId].apply(this,a.args),delete this.acks[a.ackId]);break;case"error":a.advice?this.socket.onError(a):"unauthorized"==a.reason?this.$emit("connect_failed",a.reason):this.$emit("error",a.reason)}},d.prototype.send=function(){this.namespace.flags[this.name]=!0,this.namespace.send.apply(this.namespace,arguments)},d.prototype.emit=function(){this.namespace.flags[this.name]=!0,this.namespace.emit.apply(this.namespace,arguments)}}(this.io,this.io),function(a,b,c){function d(){b.Transport.apply(this,arguments)}a.websocket=d,b.util.inherit(d,b.Transport),d.prototype.name="websocket",d.prototype.open=function(){var a,d=b.util.query(this.socket.options.query),e=this;return a||(a=c.MozWebSocket||c.WebSocket),this.websocket=new a(this.prepareUrl()+d),this.websocket.onopen=function(){e.onOpen(),e.socket.setBuffer(!1)},this.websocket.onmessage=function(a){e.onData(a.data)},this.websocket.onclose=function(){e.onClose(),e.socket.setBuffer(!0)},this.websocket.onerror=function(a){e.onError(a)},this},d.prototype.send=b.util.ua.iDevice?function(a){var b=this;return setTimeout(function(){b.websocket.send(a)},0),this}:function(a){return this.websocket.send(a),this},d.prototype.payload=function(a){for(var b=0,c=a.length;c>b;b++)this.packet(a[b]);return this},d.prototype.close=function(){return this.websocket.close(),this},d.prototype.onError=function(a){this.socket.onError(a)},d.prototype.scheme=function(){return this.socket.options.secure?"wss":"ws"},d.check=function(){return"WebSocket"in c&&!("__addTask"in WebSocket)||"MozWebSocket"in c},d.xdomainCheck=function(){return!0},b.transports.push("websocket")}("undefined"!=typeof io?io.Transport:module.exports,this.io,window),function(a,b){function c(){b.Transport.websocket.apply(this,arguments)}a.flashsocket=c,b.util.inherit(c,b.Transport.websocket),c.prototype.name="flashsocket",c.prototype.open=function(){var a=this,c=arguments;return WebSocket.__addTask(function(){b.Transport.websocket.prototype.open.apply(a,c)}),this},c.prototype.send=function(){var a=this,c=arguments;return WebSocket.__addTask(function(){b.Transport.websocket.prototype.send.apply(a,c)}),this},c.prototype.close=function(){return WebSocket.__tasks.length=0,b.Transport.websocket.prototype.close.call(this),this},c.prototype.ready=function(a,d){function e(){var b=a.options,e=b["flash policy port"],g=["http"+(b.secure?"s":"")+":/",b.host+":"+b.port,b.resource,"static/flashsocket","WebSocketMain"+(a.isXDomain()?"Insecure":"")+".swf"];c.loaded||("undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=g.join("/")),843!==e&&WebSocket.loadFlashPolicyFile("xmlsocket://"+b.host+":"+e),WebSocket.__initialize(),c.loaded=!0),d.call(f)}var f=this;return document.body?e():void b.util.load(e)},c.check=function(){return"undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject?swfobject.getFlashPlayerVersion().major>=10:!1},c.xdomainCheck=function(){return!0},"undefined"!=typeof window&&(WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0),b.transports.push("flashsocket")}("undefined"!=typeof io?io.Transport:module.exports,this.io),"undefined"!=typeof window)var swfobject=function(){function a(){if(!R){try{var a=K.getElementsByTagName("body")[0].appendChild(q("span"));a.parentNode.removeChild(a)}catch(b){return}R=!0;for(var c=N.length,d=0;c>d;d++)N[d]()}}function b(a){R?a():N[N.length]=a}function c(a){if(typeof J.addEventListener!=C)J.addEventListener("load",a,!1);else if(typeof K.addEventListener!=C)K.addEventListener("load",a,!1);else if(typeof J.attachEvent!=C)r(J,"onload",a);else if("function"==typeof J.onload){var b=J.onload;J.onload=function(){b(),a()}}else J.onload=a}function d(){M?e():f()}function e(){var a=K.getElementsByTagName("body")[0],b=q(D);b.setAttribute("type",G);var c=a.appendChild(b);if(c){var d=0;!function(){if(typeof c.GetVariable!=C){var e=c.GetVariable("$version");e&&(e=e.split(" ")[1].split(","),U.pv=[parseInt(e[0],10),parseInt(e[1],10),parseInt(e[2],10)])}else if(10>d)return d++,void setTimeout(arguments.callee,10);a.removeChild(b),c=null,f()}()}else f()}function f(){var a=O.length;if(a>0)for(var b=0;a>b;b++){var c=O[b].id,d=O[b].callbackFn,e={success:!1,id:c};if(U.pv[0]>0){var f=p(c);if(f)if(!s(O[b].swfVersion)||U.wk&&U.wk<312)if(O[b].expressInstall&&h()){var k={};k.data=O[b].expressInstall,k.width=f.getAttribute("width")||"0",k.height=f.getAttribute("height")||"0",f.getAttribute("class")&&(k.styleclass=f.getAttribute("class")),f.getAttribute("align")&&(k.align=f.getAttribute("align"));for(var l={},m=f.getElementsByTagName("param"),n=m.length,o=0;n>o;o++)"movie"!=m[o].getAttribute("name").toLowerCase()&&(l[m[o].getAttribute("name")]=m[o].getAttribute("value"));i(k,l,c,d)}else j(f),d&&d(e);else u(c,!0),d&&(e.success=!0,e.ref=g(c),d(e))}else if(u(c,!0),d){var q=g(c);q&&typeof q.SetVariable!=C&&(e.success=!0,e.ref=q),d(e)}}}function g(a){var b=null,c=p(a);if(c&&"OBJECT"==c.nodeName)if(typeof c.SetVariable!=C)b=c;else{var d=c.getElementsByTagName(D)[0];d&&(b=d)}return b}function h(){return!S&&s("6.0.65")&&(U.win||U.mac)&&!(U.wk&&U.wk<312)}function i(a,b,c,d){S=!0,y=d||null,z={success:!1,id:c};var e=p(c);if(e){"OBJECT"==e.nodeName?(w=k(e),x=null):(w=e,x=c),a.id=H,(typeof a.width==C||!/%$/.test(a.width)&&parseInt(a.width,10)<310)&&(a.width="310"),(typeof a.height==C||!/%$/.test(a.height)&&parseInt(a.height,10)<137)&&(a.height="137"),K.title=K.title.slice(0,47)+" - Flash Player Installation";var f=U.ie&&U.win?["Active"].concat("").join("X"):"PlugIn",g="MMredirectURL="+J.location.toString().replace(/&/g,"%26")+"&MMplayerType="+f+"&MMdoctitle="+K.title;if(typeof b.flashvars!=C?b.flashvars+="&"+g:b.flashvars=g,U.ie&&U.win&&4!=e.readyState){var h=q("div");c+="SWFObjectNew",h.setAttribute("id",c),e.parentNode.insertBefore(h,e),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}l(a,b,c)}}function j(a){if(U.ie&&U.win&&4!=a.readyState){var b=q("div");a.parentNode.insertBefore(b,a),b.parentNode.replaceChild(k(a),b),a.style.display="none",function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)}()}else a.parentNode.replaceChild(k(a),a)}function k(a){var b=q("div");if(U.win&&U.ie)b.innerHTML=a.innerHTML;else{var c=a.getElementsByTagName(D)[0];if(c){var d=c.childNodes;if(d)for(var e=d.length,f=0;e>f;f++)1==d[f].nodeType&&"PARAM"==d[f].nodeName||8==d[f].nodeType||b.appendChild(d[f].cloneNode(!0))}}return b}function l(a,b,c){var d,e=p(c);if(U.wk&&U.wk<312)return d;if(e)if(typeof a.id==C&&(a.id=c),U.ie&&U.win){var f="";for(var g in a)a[g]!=Object.prototype[g]&&("data"==g.toLowerCase()?b.movie=a[g]:"styleclass"==g.toLowerCase()?f+=' class="'+a[g]+'"':"classid"!=g.toLowerCase()&&(f+=" "+g+'="'+a[g]+'"'));var h="";for(var i in b)b[i]!=Object.prototype[i]&&(h+='<param name="'+i+'" value="'+b[i]+'" />');e.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+f+">"+h+"</object>",P[P.length]=a.id,d=p(a.id)}else{var j=q(D);j.setAttribute("type",G);for(var k in a)a[k]!=Object.prototype[k]&&("styleclass"==k.toLowerCase()?j.setAttribute("class",a[k]):"classid"!=k.toLowerCase()&&j.setAttribute(k,a[k]));for(var l in b)b[l]!=Object.prototype[l]&&"movie"!=l.toLowerCase()&&m(j,l,b[l]);e.parentNode.replaceChild(j,e),d=j}return d}function m(a,b,c){var d=q("param");d.setAttribute("name",b),d.setAttribute("value",c),a.appendChild(d)}function n(a){var b=p(a);b&&"OBJECT"==b.nodeName&&(U.ie&&U.win?(b.style.display="none",function(){4==b.readyState?o(a):setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function o(a){var b=p(a);if(b){for(var c in b)"function"==typeof b[c]&&(b[c]=null);b.parentNode.removeChild(b)}}function p(a){var b=null;try{b=K.getElementById(a)}catch(c){}return b}function q(a){return K.createElement(a)}function r(a,b,c){a.attachEvent(b,c),Q[Q.length]=[a,b,c]}function s(a){var b=U.pv,c=a.split(".");return c[0]=parseInt(c[0],10),c[1]=parseInt(c[1],10)||0,c[2]=parseInt(c[2],10)||0,b[0]>c[0]||b[0]==c[0]&&b[1]>c[1]||b[0]==c[0]&&b[1]==c[1]&&b[2]>=c[2]?!0:!1}function t(a,b,c,d){if(!U.ie||!U.mac){var e=K.getElementsByTagName("head")[0];if(e){var f=c&&"string"==typeof c?c:"screen";if(d&&(A=null,B=null),!A||B!=f){var g=q("style");g.setAttribute("type","text/css"),g.setAttribute("media",f),A=e.appendChild(g),U.ie&&U.win&&typeof K.styleSheets!=C&&K.styleSheets.length>0&&(A=K.styleSheets[K.styleSheets.length-1]),B=f}U.ie&&U.win?A&&typeof A.addRule==D&&A.addRule(a,b):A&&typeof K.createTextNode!=C&&A.appendChild(K.createTextNode(a+" {"+b+"}"))}}}function u(a,b){if(T){var c=b?"visible":"hidden";R&&p(a)?p(a).style.visibility=c:t("#"+a,"visibility:"+c)}}function v(a){var b=/[\\\"<>\.;]/,c=null!=b.exec(a);return c&&typeof encodeURIComponent!=C?encodeURIComponent(a):a}{var w,x,y,z,A,B,C="undefined",D="object",E="Shockwave Flash",F="ShockwaveFlash.ShockwaveFlash",G="application/x-shockwave-flash",H="SWFObjectExprInst",I="onreadystatechange",J=window,K=document,L=navigator,M=!1,N=[d],O=[],P=[],Q=[],R=!1,S=!1,T=!0,U=function(){var a=typeof K.getElementById!=C&&typeof K.getElementsByTagName!=C&&typeof K.createElement!=C,b=L.userAgent.toLowerCase(),c=L.platform.toLowerCase(),d=/win/.test(c?c:b),e=/mac/.test(c?c:b),f=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,g=!1,h=[0,0,0],i=null;if(typeof L.plugins!=C&&typeof L.plugins[E]==D)i=L.plugins[E].description,!i||typeof L.mimeTypes!=C&&L.mimeTypes[G]&&!L.mimeTypes[G].enabledPlugin||(M=!0,g=!1,i=i.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),h[0]=parseInt(i.replace(/^(.*)\..*$/,"$1"),10),h[1]=parseInt(i.replace(/^.*\.(.*)\s.*$/,"$1"),10),h[2]=/[a-zA-Z]/.test(i)?parseInt(i.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof J[["Active"].concat("Object").join("X")]!=C)try{var j=new(window[["Active"].concat("Object").join("X")])(F);j&&(i=j.GetVariable("$version"),i&&(g=!0,i=i.split(" ")[1].split(","),h=[parseInt(i[0],10),parseInt(i[1],10),parseInt(i[2],10)]))}catch(k){}return{w3:a,pv:h,wk:f,ie:g,win:d,mac:e}}();!function(){U.w3&&((typeof K.readyState!=C&&"complete"==K.readyState||typeof K.readyState==C&&(K.getElementsByTagName("body")[0]||K.body))&&a(),R||(typeof K.addEventListener!=C&&K.addEventListener("DOMContentLoaded",a,!1),U.ie&&U.win&&(K.attachEvent(I,function(){"complete"==K.readyState&&(K.detachEvent(I,arguments.callee),a())}),J==top&&!function(){if(!R){try{K.documentElement.doScroll("left")}catch(b){return void setTimeout(arguments.callee,0)}a()}}()),U.wk&&!function(){return R?void 0:/loaded|complete/.test(K.readyState)?void a():void setTimeout(arguments.callee,0)}(),c(a)))}(),function(){U.ie&&U.win&&window.attachEvent("onunload",function(){for(var a=Q.length,b=0;a>b;b++)Q[b][0].detachEvent(Q[b][1],Q[b][2]);for(var c=P.length,d=0;c>d;d++)n(P[d]);for(var e in U)U[e]=null;U=null;for(var f in swfobject)swfobject[f]=null;swfobject=null})}()}return{registerObject:function(a,b,c,d){if(U.w3&&a&&b){var e={};e.id=a,e.swfVersion=b,e.expressInstall=c,e.callbackFn=d,O[O.length]=e,u(a,!1)}else d&&d({success:!1,id:a})},getObjectById:function(a){return U.w3?g(a):void 0},embedSWF:function(a,c,d,e,f,g,j,k,m,n){var o={success:!1,id:c};U.w3&&!(U.wk&&U.wk<312)&&a&&c&&d&&e&&f?(u(c,!1),b(function(){d+="",e+="";var b={};if(m&&typeof m===D)for(var p in m)b[p]=m[p];b.data=a,b.width=d,b.height=e;var q={};if(k&&typeof k===D)for(var r in k)q[r]=k[r];if(j&&typeof j===D)for(var t in j)typeof q.flashvars!=C?q.flashvars+="&"+t+"="+j[t]:q.flashvars=t+"="+j[t];if(s(f)){var v=l(b,q,c);b.id==c&&u(c,!0),o.success=!0,o.ref=v}else{if(g&&h())return b.data=g,void i(b,q,c,n);u(c,!0)}n&&n(o)})):n&&n(o)},switchOffAutoHideShow:function(){T=!1},ua:U,getFlashPlayerVersion:function(){return{major:U.pv[0],minor:U.pv[1],release:U.pv[2]}},hasFlashPlayerVersion:s,createSWF:function(a,b,c){return U.w3?l(a,b,c):void 0},showExpressInstall:function(a,b,c,d){U.w3&&h()&&i(a,b,c,d)},removeSWF:function(a){U.w3&&n(a)},createCSS:function(a,b,c,d){U.w3&&t(a,b,c,d)},addDomLoadEvent:b,addLoadEvent:c,getQueryParamValue:function(a){var b=K.location.search||K.location.hash;if(b){if(/\?/.test(b)&&(b=b.split("?")[1]),null==a)return v(b);for(var c=b.split("&"),d=0;d<c.length;d++)if(c[d].substring(0,c[d].indexOf("="))==a)return v(c[d].substring(c[d].indexOf("=")+1))
}return""},expressInstallCallback:function(){if(S){var a=p(H);a&&w&&(a.parentNode.replaceChild(w,a),x&&(u(x,!0),U.ie&&U.win&&(w.style.display="block")),y&&y(z)),S=!1}}}}();!function(){if("undefined"!=typeof window&&!window.WebSocket){var a=window.console;if(a&&a.log&&a.error||(a={log:function(){},error:function(){}}),!swfobject.hasFlashPlayerVersion("10.0.0"))return void a.error("Flash Player >= 10.0.0 is required.");"file:"==location.protocol&&a.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,b,c,d,e){var f=this;f.__id=WebSocket.__nextId++,WebSocket.__instances[f.__id]=f,f.readyState=WebSocket.CONNECTING,f.bufferedAmount=0,f.__events={},b?"string"==typeof b&&(b=[b]):b=[],setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(f.__id,a,b,c||null,d||0,e||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var b=WebSocket.__flash.send(this.__id,encodeURIComponent(a));return 0>b?!0:(this.bufferedAmount+=b,!1)},WebSocket.prototype.close=function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id))},WebSocket.prototype.addEventListener=function(a,b){a in this.__events||(this.__events[a]=[]),this.__events[a].push(b)},WebSocket.prototype.removeEventListener=function(a,b){if(a in this.__events)for(var c=this.__events[a],d=c.length-1;d>=0;--d)if(c[d]===b){c.splice(d,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var b=this.__events[a.type]||[],c=0;c<b.length;++c)b[c](a);var d=this["on"+a.type];d&&d(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState),"protocol"in a&&(this.protocol=a.protocol);var b;if("open"==a.type||"error"==a.type)b=this.__createSimpleEvent(a.type);else if("close"==a.type)b=this.__createSimpleEvent("close");else{if("message"!=a.type)throw"unknown event type: "+a.type;var c=decodeURIComponent(a.message);b=this.__createMessageEvent("message",c)}this.dispatchEvent(b)},WebSocket.prototype.__createSimpleEvent=function(a){if(document.createEvent&&window.Event){var b=document.createEvent("Event");return b.initEvent(a,!1,!1),b}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,b){if(document.createEvent&&window.MessageEvent&&!window.opera){var c=document.createEvent("MessageEvent");return c.initMessageEvent("message",!1,!1,b,null,null,window,null),c}return{type:a,data:b,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash){if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),!window.WEB_SOCKET_SWF_LOCATION)return void a.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");var b=document.createElement("div");b.id="webSocketContainer",b.style.position="absolute",WebSocket.__isFlashLite()?(b.style.left="0px",b.style.top="0px"):(b.style.left="-100px",b.style.top="-100px");var c=document.createElement("div");c.id="webSocketFlash",b.appendChild(c),document.body.appendChild(b),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(b){b.success||a.error("[WebSocket] swfobject.embedSWF failed")})}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var b=WebSocket.__flash.receiveEvents(),c=0;c<b.length;++c)WebSocket.__instances[b[c].webSocketId].__handleEvent(b[c])}catch(d){a.error(d)}},0),!0},WebSocket.__log=function(b){a.log(decodeURIComponent(b))},WebSocket.__error=function(b){a.error(decodeURIComponent(b))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return a&&a.enabledPlugin&&a.enabledPlugin.filename&&a.enabledPlugin.filename.match(/flashlite/i)?!0:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||(window.addEventListener?window.addEventListener("load",function(){WebSocket.__initialize()},!1):window.attachEvent("onload",function(){WebSocket.__initialize()}))}}(),function(a,b,c){function d(a){a&&(b.Transport.apply(this,arguments),this.sendBuffer=[])}function e(){}a.XHR=d,b.util.inherit(d,b.Transport),d.prototype.open=function(){return this.socket.setBuffer(!1),this.onOpen(),this.get(),this.setCloseTimeout(),this},d.prototype.payload=function(a){for(var c=[],d=0,e=a.length;e>d;d++)c.push(b.parser.encodePacket(a[d]));this.send(b.parser.encodePayload(c))},d.prototype.send=function(a){return this.post(a),this},d.prototype.post=function(a){function b(){4==this.readyState&&(this.onreadystatechange=e,f.posting=!1,200==this.status?f.socket.setBuffer(!1):f.onClose())}function d(){this.onload=e,f.socket.setBuffer(!1)}var f=this;this.socket.setBuffer(!0),this.sendXHR=this.request("POST"),c.XDomainRequest&&this.sendXHR instanceof XDomainRequest?this.sendXHR.onload=this.sendXHR.onerror=d:this.sendXHR.onreadystatechange=b,this.sendXHR.send(a)},d.prototype.close=function(){return this.onClose(),this},d.prototype.request=function(a){var c=b.util.request(this.socket.isXDomain()),d=b.util.query(this.socket.options.query,"t="+ +new Date);if(c.open(a||"GET",this.prepareUrl()+d,!0),"POST"==a)try{c.setRequestHeader?c.setRequestHeader("Content-type","text/plain;charset=UTF-8"):c.contentType="text/plain"}catch(e){}return c},d.prototype.scheme=function(){return this.socket.options.secure?"https":"http"},d.check=function(a,d){try{var e=b.util.request(d),f=c.XDomainRequest&&e instanceof XDomainRequest,g=a&&a.options&&a.options.secure?"https:":"http:",h=c.location&&g!=c.location.protocol;if(e&&(!f||!h))return!0}catch(i){}return!1},d.xdomainCheck=function(a){return d.check(a,!0)}}("undefined"!=typeof io?io.Transport:module.exports,this.io,window),function(a,b){function c(){b.Transport.XHR.apply(this,arguments)}a.htmlfile=c,b.util.inherit(c,b.Transport.XHR),c.prototype.name="htmlfile",c.prototype.get=function(){this.doc=new(window[["Active"].concat("Object").join("X")])("htmlfile"),this.doc.open(),this.doc.write("<html></html>"),this.doc.close(),this.doc.parentWindow.s=this;var a=this.doc.createElement("div");a.className="socketio",this.doc.body.appendChild(a),this.iframe=this.doc.createElement("iframe"),a.appendChild(this.iframe);var c=this,d=b.util.query(this.socket.options.query,"t="+ +new Date);this.iframe.src=this.prepareUrl()+d,b.util.on(window,"unload",function(){c.destroy()})},c.prototype._=function(a,b){a=a.replace(/\\\//g,"/"),this.onData(a);try{var c=b.getElementsByTagName("script")[0];c.parentNode.removeChild(c)}catch(d){}},c.prototype.destroy=function(){if(this.iframe){try{this.iframe.src="about:blank"}catch(a){}this.doc=null,this.iframe.parentNode.removeChild(this.iframe),this.iframe=null,CollectGarbage()}},c.prototype.close=function(){return this.destroy(),b.Transport.XHR.prototype.close.call(this)},c.check=function(a){if("undefined"!=typeof window&&["Active"].concat("Object").join("X")in window)try{var c=new(window[["Active"].concat("Object").join("X")])("htmlfile");return c&&b.Transport.XHR.check(a)}catch(d){}return!1},c.xdomainCheck=function(){return!1},b.transports.push("htmlfile")}("undefined"!=typeof io?io.Transport:module.exports,this.io),function(a,b,c){function d(){b.Transport.XHR.apply(this,arguments)}function e(){}a["xhr-polling"]=d,b.util.inherit(d,b.Transport.XHR),b.util.merge(d,b.Transport.XHR),d.prototype.name="xhr-polling",d.prototype.heartbeats=function(){return!1},d.prototype.open=function(){var a=this;return b.Transport.XHR.prototype.open.call(a),!1},d.prototype.get=function(){function a(){4==this.readyState&&(this.onreadystatechange=e,200==this.status?(f.onData(this.responseText),f.get()):f.onClose())}function b(){this.onload=e,this.onerror=e,f.retryCounter=1,f.onData(this.responseText),f.get()}function d(){f.retryCounter++,!f.retryCounter||f.retryCounter>3?f.onClose():f.get()}if(this.isOpen){var f=this;this.xhr=this.request(),c.XDomainRequest&&this.xhr instanceof XDomainRequest?(this.xhr.onload=b,this.xhr.onerror=d):this.xhr.onreadystatechange=a,this.xhr.send(null)}},d.prototype.onClose=function(){if(b.Transport.XHR.prototype.onClose.call(this),this.xhr){this.xhr.onreadystatechange=this.xhr.onload=this.xhr.onerror=e;try{this.xhr.abort()}catch(a){}this.xhr=null}},d.prototype.ready=function(a,c){var d=this;b.util.defer(function(){c.call(d)})},b.transports.push("xhr-polling")}("undefined"!=typeof io?io.Transport:module.exports,this.io,window),function(a,b,c){function d(){b.Transport["xhr-polling"].apply(this,arguments),this.index=b.j.length;var a=this;b.j.push(function(b){a._(b)})}var e=c.document&&"MozAppearance"in c.document.documentElement.style;a["jsonp-polling"]=d,b.util.inherit(d,b.Transport["xhr-polling"]),d.prototype.name="jsonp-polling",d.prototype.post=function(a){function c(){d(),e.socket.setBuffer(!1)}function d(){e.iframe&&e.form.removeChild(e.iframe);try{g=document.createElement('<iframe name="'+e.iframeId+'">')}catch(a){g=document.createElement("iframe"),g.name=e.iframeId}g.id=e.iframeId,e.form.appendChild(g),e.iframe=g}var e=this,f=b.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);if(!this.form){var g,h=document.createElement("form"),i=document.createElement("textarea"),j=this.iframeId="socketio_iframe_"+this.index;h.className="socketio",h.style.position="absolute",h.style.top="0px",h.style.left="0px",h.style.display="none",h.target=j,h.method="POST",h.setAttribute("accept-charset","utf-8"),i.name="d",h.appendChild(i),document.body.appendChild(h),this.form=h,this.area=i}this.form.action=this.prepareUrl()+f,d(),this.area.value=b.JSON.stringify(a);try{this.form.submit()}catch(k){}this.iframe.attachEvent?g.onreadystatechange=function(){"complete"==e.iframe.readyState&&c()}:this.iframe.onload=c,this.socket.setBuffer(!0)},d.prototype.get=function(){var a=this,c=document.createElement("script"),d=b.util.query(this.socket.options.query,"t="+ +new Date+"&i="+this.index);this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),c.async=!0,c.src=this.prepareUrl()+d,c.onerror=function(){a.onClose()};var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(c,f),this.script=c,e&&setTimeout(function(){var a=document.createElement("iframe");document.body.appendChild(a),document.body.removeChild(a)},100)},d.prototype._=function(a){return this.onData(a),this.isOpen&&this.get(),this},d.prototype.ready=function(a,c){var d=this;return e?void b.util.load(function(){c.call(d)}):c.call(this)},d.check=function(){return"document"in c},d.xdomainCheck=function(){return!0},b.transports.push("jsonp-polling")}("undefined"!=typeof io?io.Transport:module.exports,this.io,window),"function"==typeof define&&define.amd}.call(window.TrackDuck),function(a){function b(){var b=(navigator.language||navigator.userLanguage).split("-")[0];a.locale=a.translations[a.userLang]?a.userLang:a.translations[a.config.webSiteLang]?a.config.webSiteLang:a.translations[b]?b:"en"}a.t=function(b){return a.translations[a.locale][b]||a.translations.en[b]||b},a.translations={},a.translations.en={SAVE:"Save",DELETE:"Delete",CANCEL:"Cancel",ADMIN:"Admin",ANONYMOUS:"Anonymous",ASSIGNED_TO:"Assigned to",ASSIGNED_TO_ME:"Assigned to you",CHANGE_STATUS_INFO:"Note: to remove users or update status, open Project Settings.",CLICK_HOLD_TO_SELECT:"Click and hold mouse button, then drag to select an area.",CONFIRM_VIDEO_NO_SAVE:"Are you sure don't want to save this video feedback?",CONTRIBUTOR:"Contributor",CREATED_BY_ME:"Created by you",CREATE_NEW_ISSUE:"New comment",DELETE_CONFIRM:"Are you sure you want to delete?",EMAIL:"Email",ENTER_SUBMIT:"Enter to submi",HIDDEN_COMMENTS:"hidden comments",INVITE_SENDED:"Invite sent!",LOGIN_TO_COMMENT:"You need to login to write comments",NEW:"New",NOT_ASSIGNED:"Not assigned",OPTIONAL:"optional",OS_BROWSER:"OS & browser",REPORTER:"Reporter",RESOLUTION:"Resolution",SAVE_CAPTURE:"Save screen capture",SEND:"Send",SHARE_LINK_PUBLIC:"Share this link to make the project public. Everyone with the link can view your comments.",SHOW_COMPLETED:"Show completed",TASK_STATUS:"Task status",THANK_FEEDBACK:"Thank you for feedback!",TIME_AT:"at",TODAY:"today",WRITE_COMMENT:"Write a comment...",YESTERDAY:"yesterday"},a.translations.ru={SAVE:"Сохранить",DELETE:"Удалить",CANCEL:"Отменить",ADMIN:"Администратор",ANONYMOUS:"Анонимный",ASSIGNED_TO:"Назначена",ASSIGNED_TO_ME:"Ваши задачи",CHANGE_STATUS_INFO:"Если вы хотите изменить права или удалить существующего пользователя, пожалуйста, откройте настройки вашего проекта",CLICK_HOLD_TO_SELECT:"Зажмите левую клавишу мыши и переместите курсор, чтобы выделить область для комментирования",CONFIRM_VIDEO_NO_SAVE:"Вы действительно не хотите сохранить видео сессию?",CONTRIBUTOR:"Участник",CREATED_BY_ME:"Созданные вами",CREATE_NEW_ISSUE:"Новый комментарий",DELETE_CONFIRM:"Вы действительно хотите удалить запись?",EMAIL:"Email",ENTER_SUBMIT:'Нажмите "Enter" чтобы отправить',HIDDEN_COMMENTS:"скрытые комментари",INVITE_SENDED:"Приглашение выслано!",LOGIN_TO_COMMENT:"Чтобы начать комментирование вам нужно войти в систему",NEW:"Новый",NOT_ASSIGNED:"Не назначен испольнитель",OPTIONAL:"необязательно",OS_BROWSER:"ОС и браузер",REPORTER:"Комментатор",RESOLUTION:"Разрешение",SAVE_CAPTURE:"Сохранить видео",SEND:"Отправить",SHARE_LINK_PUBLIC:"Вы можете поделиться этой ссылкой чтобы сделать проект публичным. Все у кого есть доступ к данный ссылке смогут просмотреть ваши комментарии.",SHOW_COMPLETED:"Показать выполненные",TASK_STATUS:"Статус задачи",THANK_FEEDBACK:"Спасибо за ваш комментарий!",TIME_AT:"в",TODAY:"Сегодня",WRITE_COMMENT:"Написать комментарий...",YESTERDAY:"Вчера"},a.translations.de={SAVE:"Speichern",DELETE:"Löschen",CANCEL:"Abbrechen",ADMIN:"Administrator",ANONYMOUS:"Anonym",ASSIGNED_TO:"Zugewiesen zu",ASSIGNED_TO_ME:"Ihnen zugewiesen",CHANGE_STATUS_INFO:"Anmerkung: Wenn Sie Benutzer löschen oder einen Status ändern möchten, öffnen Sie die Projekteinstellungen.",CLICK_HOLD_TO_SELECT:"Klicken Sie und wählen Sie mit gedrückter Maustaste einen Bereich aus.",CONFIRM_VIDEO_NO_SAVE:"Sind Sie sicher, dass Sie das Video-Feedback nicht speichern möchten?",CONTRIBUTOR:"Teilnehmer",CREATED_BY_ME:"Durch Sie erstellt",CREATE_NEW_ISSUE:"Neuer Kommentar",DELETE_CONFIRM:"Sind Sie sicher, dass Sie es löschen möchten?",EMAIL:"E-Mail",ENTER_SUBMIT:null,HIDDEN_COMMENTS:"versteckte Kommentare",INVITE_SENDED:"Einladung versendet!",LOGIN_TO_COMMENT:"Sie müssen sich einloggen, um Kommentare zu schreiben",NEW:"Neu",NOT_ASSIGNED:"Nicht zugeordnet",OPTIONAL:"optional",OS_BROWSER:"Betriebssystem & Browser",REPORTER:"Beobachter",RESOLUTION:"Auflösung",SAVE_CAPTURE:"Screen Capture speichern",SEND:null,SHARE_LINK_PUBLIC:"Teilen Sie diesen Link, um das Projekt öffentlich zu machen. Alle, die Zugang zu diesem Link haben, können Ihre Kommentare sehen.",SHOW_COMPLETED:"Abgeschlossene Aufgaben anzeigen",TASK_STATUS:null,THANK_FEEDBACK:"Vielen Dank für Ihr Feedback!",TIME_AT:"um",TODAY:"heute",WRITE_COMMENT:"Kommentar schreiben...",YESTERDAY:"gestern"},a.translations.zh={PRIORITY:"优先",SAVE:"存储",DELETE:"删除问题",CANCEL:"取消",ADMIN:"行政员",ANONYMOUS:"匿名",ASSIGNED_TO:"分配给",CHANGE_STATUS_INFO:"如果你想改变现状或删除现有的用户，请打开当前的项目设置",CLICK_HOLD_TO_SELECT:"单击并按鼠标键，然后拖动以选择区域",CLOSED:"关闭",COMMENT_DELETE_CONF:"您确定要删除这个评论吗？",CONTINUE:"继续",CONTRIBUTOR:"贡献者",CREATE_NEW_ISSUE:"新评论",EMAIL:"电邮",HIDDEN_COMMENTS:"隐藏的评论",IN_PROGRESS:"进展中",INVITE_SENDED:"邀请已发出",INVITE_USER:"邀请用户",NEW:"新",NOT_ASSIGNED:"未分配",OPTIONAL:"可选",OS_BROWSER:"操作系统和浏览器",REPORTER:"报告人",RESOLUTION:"屏幕分辨率",RESOLVED:"已解决",SHARE_LINK_PUBLIC:"分享此链接以使项目公开。每个拥有此链的用户接可以存取您的评论！",SHOW_COMPLETED:"显示已完成的项目",THANK_FEEDBACK:"谢谢您的反馈！",TIME_AT:"于",TODAY:"今天",WRITE_COMMENT:"留下评论。。。",YESTERDAY:"昨天"},a.translations.fr={SAVE:"Enregistrer",DELETE:"Effacer",CANCEL:"Annuler",ADMIN:"Administrateur",ANONYMOUS:"Anonyme",ASSIGNED_TO:"Affecté à :",ASSIGNED_TO_ME:"Affecté à vous",CHANGE_STATUS_INFO:"Remarque : pour supprimer les utilisateurs ou mettre le statut à jour, ouvrez les Paramètres du Projet.",CLICK_HOLD_TO_SELECT:"Cliquez avec le bouton de la souris, maintenez-le enfoncé et glissez pour sélectionner une zone.",CONFIRM_VIDEO_NO_SAVE:"Êtes-vous sûr de ne pas vouloir enregistrer cet avis vidéo ?",CONTRIBUTOR:"Contributeur",CREATED_BY_ME:"Créé par vous",CREATE_NEW_ISSUE:"Nouveau commentaire",DELETE_CONFIRM:"Êtes-vous sûr de vouloir l'effacer ?",EMAIL:"Email",ENTER_SUBMIT:null,HIDDEN_COMMENTS:"commentaires cachés",INVITE_SENDED:"Invitation envoyée !",LOGIN_TO_COMMENT:"Vous devez vous connecter pour écrire des commentaires",NEW:"Nouveau",NOT_ASSIGNED:"Non affecté",OPTIONAL:"optionnel",OS_BROWSER:"OS et navigateur",REPORTER:"Rapporteur",RESOLUTION:"Résolution",SAVE_CAPTURE:"Enregistrer la capture d'écran",SEND:null,SHARE_LINK_PUBLIC:"Partagez ce lien pour ouvrir l'accès public au projet. Toute personne ayant ce lien pourra voir vos commentaires.",SHOW_COMPLETED:"Afficher les tâches terminées",TASK_STATUS:null,THANK_FEEDBACK:"Merci pour votre avis !",TIME_AT:"à",TODAY:"aujourd’hui",WRITE_COMMENT:"Écrire un commentaire...",YESTERDAY:"hier"},a.translations.lt={SAVE:"Išsaugoti",DELETE:"Ištrinti",CANCEL:"Atšaukti",ADMIN:"Administratorius",ANONYMOUS:"Anoniminis",ASSIGNED_TO:"Priskirta",ASSIGNED_TO_ME:"Priskirta Jums",CHANGE_STATUS_INFO:"Pastaba: norėdami ištrinti bendradarbius arba pakeisti statusą, atidarykite projekto nustatymus.",CLICK_HOLD_TO_SELECT:"Jeigu radote klaidą, pažymėkite ją pelės žymekliu ir palikite komentarą.",CONFIRM_VIDEO_NO_SAVE:"Ar tikrai nenorite išsaugoti šio vizualaus grįžtamojo ryšio?",CONTRIBUTOR:"Bendradarbis",CREATED_BY_ME:"Sukurta Jūsų",CREATE_NEW_ISSUE:"Naujas komentaras",DELETE_CONFIRM:"Ar tikrai norite ištrinti?",EMAIL:"El. paštas",ENTER_SUBMIT:'"Enter" - siųsti',HIDDEN_COMMENTS:"Paslėpti komentarai",INVITE_SENDED:"Pakvietimas išsiųstas!",LOGIN_TO_COMMENT:"Norėdami komentuoti, prisijunkite",NEW:"Naujas",NOT_ASSIGNED:"Nepriskirta",OPTIONAL:"Neprivaloma",OS_BROWSER:"OS ir naršyklė",REPORTER:"Raportuotojas",RESOLUTION:"Raiška",SAVE_CAPTURE:"Išsaugoti vaizdo įrašą",SEND:"Siųsti",SHARE_LINK_PUBLIC:"Pasidalinkite šia nuoroda, kad padarytumėte projektą viešu. Visi, kas turi šią nuoroda galės matyti Jūsų komentarus.",SHOW_COMPLETED:"Rodyti užbaigtus",TASK_STATUS:"Užduoties būsena",THANK_FEEDBACK:"Ačiū už atsiliepimą!",TIME_AT:"Į",TODAY:"Šiandien",WRITE_COMMENT:"Rašyti komentarą...",YESTERDAY:"Vakar"},a.translations.es={SAVE:"Guardar",DELETE:"Eliminar",CANCEL:"Cancelar",ADMIN:"Admin",ANONYMOUS:"Anónimo",ASSIGNED_TO:"Asignado a",ASSIGNED_TO_ME:"Asignado a usted",CHANGE_STATUS_INFO:"Note: para remover usuarios o actualizar su estado, abra Ajustes del proyecto.",CLICK_HOLD_TO_SELECT:"Mantener pulsada la tecla del mouse, luego arrastrar al área deseada.",CONFIRM_VIDEO_NO_SAVE:"Esta seguro que no desea guardar video feedback?",CONTRIBUTOR:"Contribuyente",CREATED_BY_ME:"Creado por usted",CREATE_NEW_ISSUE:"Nuevo comentario",DELETE_CONFIRM:"¿De verdad quieres eliminarlo?",EMAIL:"Correo electrónico",ENTER_SUBMIT:null,HIDDEN_COMMENTS:"comentarios ocultos",INVITE_SENDED:"¡Invitación enviada!",LOGIN_TO_COMMENT:"Acceda a su cuenta para escribir comentarios",NEW:"Nuevo",NOT_ASSIGNED:"No asignado",OPTIONAL:"opcional",OS_BROWSER:"OS y navegador",REPORTER:"Reportero",RESOLUTION:"Resolución",SAVE_CAPTURE:"Guardar captura de pantalla",SEND:null,SHARE_LINK_PUBLIC:"Comparta este enlace para hacer el proyecto público. Todos los que tengan este enlace podrán ver tus comentarios.",SHOW_COMPLETED:"Mostrar finalizados",TASK_STATUS:null,THANK_FEEDBACK:"¡Gracias por el feedback!",TIME_AT:"en",TODAY:"hoy",WRITE_COMMENT:"Escribir un comentario...",YESTERDAY:"ayer"},b()}(window.TrackDuck),function(a){var b={};b.bar_main='<a data-tdtp="logo" href="#" class="td_logo" title="Hide everything"></a>\n<div data-tdtp="barControls" class="td_bar_controls">\n    <a data-tdtp="share" href="#" class="td_bar_share" title="Project sharing options"></a>\n    <a data-tdtp="hide" href="#" class="td_bar_hide" title="Show list">\n        <span data-tdtp="issueCount" class="td_bar_count">\n            <span class="td_progress">\n                <span></span>\n            </span>\n        </span>\n    </a>\n    <div class="td_bar_cont_new">\n        <a data-tdtp="newIssue" href="#" class="td_bar_new_issue" title="Create new task"></a>\n        <a data-tdtp="newVideo" href="#" class="td_bar_new_video" title="Record video feedback">\n            <span data-tdtp="videoProgress" class="td_bar_video_upload_progress"></span>\n        </a>\n    </div>\n    <a data-tdtp="endVideo" href="#" class="td_bar_end_video" title="Stop screen recording">\n        <span data-tdtp="endVideoTime">00:00</span>\n    </a>\n    <br class="td_clear" />\n</div>\n<div data-tdtp="listAnim" class="td_bar_list_anim">\n    <div data-tdtp="listCont" class="td_bar_list">\n        <div data-tdtp="preList" class="td_bar_pre_list">\n            <div class="td_bar_filters_container">\n                <div class="td_bar_filters_head">\n                    <span><span class="td_bar_filters_ico2"></span> Filters</span>\n                    <a data-tdtp="clearFilters" class="td_bar_filters_clear" href="#"><strong>&times;</strong> Clear</a>\n                </div>\n                <div class="td_bar_filters_drop">\n                    <a data-tdtp="showCompleted" href="#" class="td_bar_filters td_bar_filter_completed"></a>\n                    <a data-tdtp="showAssignedToMe" href="#" class="td_bar_filters td_bar_filter_assigned"></a>\n                    <a data-tdtp="showCreatedByMe" href="#" class="td_bar_filters td_bar_filter_created"></a>\n                </div>\n            </div>\n        </div>\n        <ul data-tdtp="list" class="td_bar_list_issues"></ul>\n    </div>\n    <div data-tdtp="inviteCont" class="td_bar_invite_cont"></div>\n</div>',b.bar_show_invite='<div class="td_bar_invite_email">\n    <input class="js_td_e_input" type="email" title="Invite user by email" />\n    <a class="td_bar_s_i" href="#"></a>\n    <p><a class="js_td_e_info" target="_blank"></a></p>\n</div>\n<div class="td_bar_invite_share">\n    <div class="td_bar_invite_divider"></div>\n    <div class="td_bar_invite_s_info"></div>\n    <input type="text" class="td_bar_invite_s_input" />\n    <a href="#" class="td_bar_s_update"></a>\n</div>',b.comment_tech='<a data-tdtp="task" href="#" title target="_blank" class="td_bold"></a>\n<span data-tdtp="txtWas"></span>\n<span data-tdtp="ua" class="td_bold"></span>\n<br />\n<span data-tdtp="os"></span>\n<span data-tdtp="screen" class="td_bold"></span>\n',b.extension_popup='<div data-tdtp="login_window" style="display: none;">\n    <a data-tdtp="logo_login" href="#" target="_blank" class="td_extension_logo"></a>\n    <div class="td_extension_text td_extension_msg_head">Sign up to start using TrackDuck extension</div>\n    <div style="padding-top: 15px;">\n        <a data-tdtp="login_google" href="#" class="td_extension_login_google">Sign up with <strong>Google</strong></a>\n        <a data-tdtp="login_facebook" href="#" class="td_extension_login_facebook">Sign up with <strong>Facebook</strong></a>\n    </div>\n    <br class="td_clear" />\n    <a data-tdtp="login_email" href="#" class="td_extension_login_email">email login</a>\n    <span>or</span>\n    <a data-tdtp="register_email" href="#" class="td_extension_login_email">register</a>\n</div>\n\n<div data-tdtp="project_window" style="display: none;">\n    <a data-tdtp="logo_project" href="#" target="_blank" class="td_extension_logo"></a>\n    <div class="td_extension_text td_extension_msg_head">Choose or add a new project to TrackDuck for this website tasks</div>\n    <div data-tdtp="list_projects" class="td_extension_list_project">\n        <select data-tdtp="projects_select">\n            <option>Loading...</option>\n        </select>\n        <a data-tdtp="add_action" href="#" class="td_extension_add"></a>\n    </div>\n</div>\n\n<div data-tdtp="info_window" style="display: none;">\n    <div class="td_extension_info">\n        <div class="td_extension_icon"></div>\n        <div class="td_extension_msg_head" data-tdtp="info_title"></div>\n        <span data-tdtp="info_text"></span>\n    </div>\n</div>',b.task_comment='<div data-tdtp="info" class="td_comment_info">\n    <div class="td_issue_comment_avatar_cont">\n        <img data-tdtp="avatar" src="" />\n    </div>\n    <div class="td_comment_detail_cont">\n        <span data-tdtp="commentBy" class="td_comment_by"></span>\n        <span data-tdtp="time" class="td_comment_time" title></span>\n    </div>\n    <div class="td_comment_remove_cont">\n        <a data-tdtp="remove" class="td_remove_comment" href="#" title></a>\n    </div>\n    <br class="td_clear" />\n</div>\n<div data-tdtp="text" class="td_comment_text"></div>\n<div data-tdtp="commentExtra" class="td_comment_extra"></div>',b.task_ui='<div data-tdtp="issueContainer" class="td_issue_container">\n    <div data-tdtp="traingle" class="td_issue_triangle"></div>\n\n    <div data-tdtp="head" class="td_issue_head">\n        <div class="td_issue_assignee">\n            <div class="td_issue_avatar_cont">\n                <img data-tdtp="avatarImg" data-html2canvas-ignore alt="Gravatar" src="" class="td_issue_avatar_img" />\n            </div>\n            <span data-tdtp="assignedText" class="td_up_silver"></span>\n            <div data-tdtp="assignee" class="td_select_assignee">\n                <div data-tdtp="assigneeGhost" class="td_select_ghost"></div>\n                <div data-tdtp="assigneeHolder" class="td_select_content"></div>\n            </div>\n        </div>\n        <div data-tdtp="priority" class="td_issue_priority" title>\n            <input data-tdtp="priorityInput" type="hidden" value="0" class="td_prior_input" />\n        </div>\n        <div data-tdtp="status" class="td_issue_status" title>\n            <input data-tdtp="statusInput" type="hidden" value="0" class="td_status_input" />\n        </div>\n        <div data-tdtp="customStatuses" class="td_issue_custom_statuses" title>\n            <span data-tdtp="customStatusesTitle" class="td_up_silver"></span>\n            <select data-tdtp="customStatusesSelect" class="td_custom_status_select"></select>\n        </div>\n        <br class="td_clear" />\n    </div>\n\n    <div class="td_comments_container">\n        <div data-tdtp="descriptionContainer" class="td_c_d"></div>\n        <div data-tdtp="commentsContainer" class="td_c_c"></div>\n    </div>\n\n    <div class="td_add_comment_bg">\n        <div class="td_add_comment_container">\n            <input data-tdtp="anonEmail" class="td_add_comment_input" type="text" />\n            <div data-tdtp="emailError" class="td_add_comment_email_err"></div>\n            <textarea data-tdtp="textarea" class="td_add_comment_textarea" placeholder></textarea>\n            <input data-tdtp="hiddenDescription" type="hidden" />\n            <div data-tdtp="addCommentExtra" class="td_add_comment_extra"></div>\n            <div class="td_add_comment_bottom">\n                <span class="td_add_comment_zxc" data-tdtp="attachmentsContainter">\n                    <a data-tdtp="attachScreenShot" class="td_add_comment_area" href="#"></a>\n                    <span data-tdtp="attachFile" class="td_add_comment_file">\n                        <input data-tdtp="attachFileInput" class="td_add_comment_file_input" multiple type="file" />\n                    </span>\n                </span>\n                <a data-tdtp="addCommentBtn" href="#" title class="td_add_comment_btn"></a>\n                <span data-tdtp="addCommentHelp" class="td_add_comment_asd"></span>\n            </div>\n        </div>\n    </div>\n</div>',a.templates=b}(window.TrackDuck),function(a){a.issueTemplate={description:"",priority:0,status:0,data:[]},a.events={},a.socket={},a.base64Images={},a.variables={},a.ui={},a.variables.wrongMirrorTags=["IMG","OBJECT","EMBED","VIDEO","AUDIO"],a.ClassFactory=function(){var a={};return function(b,c,d){if(a[b]=d?d:function(){},c){var e=a[c+"Surrogate"];if(!e){var f=a[c];e=function(){},e.prototype=f.prototype,a[c+"Surrogate"]=e}a[b].prototype=new e,a[b].prototype.constructor=b}return a[b].prototype.regCb=function(){this.$e||(this.$e={});for(var a=arguments[arguments.length-1],b=0;b<arguments.length-1;b++){var c=arguments[b],d=this.$e[c];d?d.push(a):d=this.$e[c]=[a]}},a[b].prototype.fireCb=function(a){this.$e||(this.$e={});var b=this.$e[a];delete arguments[0];var c=[];for(var d in arguments)c.push(arguments[d]);if(b&&b.length>0)for(var e=0;e<b.length;e++)b[e].apply(this,c)},a[b]}}(),a.init=function(b){function c(){a.util.waitForFinalEvent(function(){a.updateMarkersPosition(),a.ui.editBugWindow.visible&&a.ui.editBugWindow.setContainerPosition()},200,"element_scroll")}a.addListener("resize",parent,function(){a.util.waitForFinalEvent(function(){if(a.popup.visible&&a.popup.updatePosition(),a.updateMarkersPosition(),a.ui.editBugWindow.visible){var b=a.ui.editBugWindow.position;a.popup.setDimensions(a.getMarkerPosition(b).x,a.getMarkerPosition(b).y-b.height,b.width,b.height),a.ui.editBugWindow.setRootPosition(),a.ui.editBugWindow.setContainerPosition()}a.setMobileVersion(a.domain.isMobileWidth())},500,"window_resized")});for(var d=document.getElementsByTagName("div"),e=0;e<d.length;e++){var f=window.getComputedStyle(d[e]);("visible"!==f.getPropertyValue("overflow-x")||"visible"!==f.getPropertyValue("overflow-y"))&&a.addListener("scroll",d[e],c)}switch(a.setMobileVersion(a.domain.isMobileWidth()),a.initWidgets(a.mode),a.setWebService(a.mode),a.mode){case"manager":this.loadIssueStatuses(),this.loadContributorRoles(),this.loadContributors(),1===a.issuesFilter.showCompleted()?this.loadAllPoints():this.loadNotCompetedPoints();break;case"demo":this.loadIssueStatuses(),this.loadContributorRoles(),this.demoLoadContributors(),this.demoLoadAllPoints(),a.loaded.setK("MarkedDomItems"),a.loaded.setK("Contributors");break;case"anonDemo":break;case"anon":}a.toolbarVisibility.exec(),b&&b()},a.addListener("mousemove",parent.document,function(b){a.vars.mouseClient={x:b.clientX,y:b.clientY}}),a.initWidgets=function(b){switch(b){case"manager":case"demo":a.ui.bar.init(),a.ui.editBugWindow.init(),a.ui.newBugWindow.init(),a.ui.newBugVideoWindow.init(),a.ui.editBugVideoWindow.init(),a.ui.tooltipWindow.init(),a.ui.newAnonWindow.init();break;case"anon":case"anonDemo":a.ui.newAnonWindow.init()}},a.CustomOutlineSelect=function(b){a.afterOutlineSelect(),new a.NewItem(b,a.ui.newBugWindow,"manager")},a.customOutlineSelectAnon=function(b){a.afterOutlineSelect(),new a.NewItem(b,a.ui.newAnonWindow,"anon")},a.customOutlineSelectVideo=function(b,c,d){a.popup.show(!1),a.vars.videoBlob=b;var e=URL.createObjectURL(b),f=a.ui.newBugVideoWindow.elements.root;f.style.height=d+6+"px",f.style.width=c+6+"px",f.style.backgroundImage="url("+e+")",f.setAttribute("data-url",e),new a.NewItem(f,a.ui.newBugVideoWindow,"anon","image/gif")},a.afterOutlineSelect=function(){a.removeClass(document.body,"td_cursor_move"),a.variables.popupGoust&&(document.body.removeChild(a.variables.popupGoust),delete a.variables.popupGoust)},a.showStartSelectArea=function(b,c,d){function e(d){a.Drag.outline(d,b,c),a.popup.show(!1),a.removeListener("mousedown",document,e),a.removeListener("touchstart",document,e),a.removeListener("keydown",window,f)
}function f(b){27===b.keyCode&&(a.popup.hide(),a.afterOutlineSelect(),a.removeListener("mousedown",document,e),a.removeListener("touchstart",document,e),a.removeListener("keydown",window,f),a.removeListener("keydown",window.parent,f),"function"==typeof d&&d())}a.popup.show(a.config.textClickHold||a.t("CLICK_HOLD_TO_SELECT")),a.addClass(document.body,"td_cursor_move"),a.variables.popupGoust=document.createElement("div"),a.variables.popupGoust.className="trackduck_overlay td_goust_overlay",a.variables.popupGoust.style.display="block",a.variables.popupGoust.style.zIndex=a.util.topZIndex+4,document.body.appendChild(a.variables.popupGoust),a.addListener("mousedown",document,e),a.addListener("touchstart",document,e),a.addListener("keydown",window,f),a.addListener("keydown",window.parent,f)},a.initAnonOutline=function(){a.showStartSelectArea(a.customOutlineSelectAnon,a.ui.newAnonWindow.elements.root)},a.getNotStaticParent=function(b){return"static"!==window.getComputedStyle(b).getPropertyValue("position")?b:b.parentElement&&"BODY"!==b.parentElement.tagName?a.getNotStaticParent(b.parentElement):b},a.calculateOutlineElementArea=function(b){var c=b.offsetWidth,d=b.offsetHeight,e=b.getBoundingClientRect().left,f=b.getBoundingClientRect().top;a.rootElement.style.display="none",a.frame.getElement().style.display="none";var g=parent.document.elementFromPoint(e-a.util.getDocumentScrollXY().x+c/2,f-a.util.getDocumentScrollXY().y+d/2);return a.rootElement.style.display="",a.frame.getElement().style.display="",g=g||parent.document.body,{x:e,y:f+d,width:c,height:d,screen:{width:parent.window.innerWidth,height:parent.window.innerHeight},resolution:{width:parent.screen.width,height:parent.screen.height},relative:{element:a.getElementXPath(g),x:e-(g.getBoundingClientRect().left+a.util.getDocumentScrollXY().x),y:f+d-(g.getBoundingClientRect().top+a.util.getDocumentScrollXY().y)}}},a.updateMarkersPosition=function(){for(var b in a.dataStorage.MarkedDomItems.data)a.dataStorage.MarkedDomItems.data[b].pageMarker&&a.dataStorage.MarkedDomItems.data[b].pageMarker.update()},a.removeAllMarkers=function(){for(var b in a.dataStorage.MarkedDomItems.data)a.dataStorage.MarkedDomItems.data[b].pageMarker&&(a.dataStorage.MarkedDomItems.data[b].listMarker.remove(),a.dataStorage.MarkedDomItems.data[b].pageMarker.remove(),delete a.dataStorage.MarkedDomItems.data[b]);a.dataStorage.MarkedDomItems.data={},a.ui.bar.showIssueCount(0)},a.getElementXPath=function(b,c){var c=c||[],d=a.getSiblingPosition(b);return d=d>-1&&"HTML"!=b.tagName&&"BODY"!=b.tagName?":nth-child("+d+")":"",c.push(b.tagName.toLowerCase()+d),b.parentElement&&"HTML"!=b.parentElement.tagName?a.getElementXPath(b.parentElement,c):c.reverse().join(" > ")},a.getElementByXPath=function(){var a={};return function(b){function c(a,b){if(0===a.length)return b;if(!b)return null;for(var d=a.split(">"),e=d.shift().split(":"),f=0,g=void 0!==e[1]?e[1].substr(10,e[1].indexOf(")")-10):1,h=0,i=b.children.length;i>h;h++)if(-1!==b.children[h].className.indexOf("td_marker")&&f++,h-f===g-1)return c(d.join(">"),b.children[h])}return b?void 0===a[b]?a[b]=c(b.replace("body > ",""),document.body):a[b]:null}}(),a.getSiblingPosition=function(a){if(!a.parentElement)return-1;var b=a.parentElement.children,c=0;if(!b||1==b.length)return-1;for(var d=0;d<b.length;d++)if("!"==b[d].tagName&&c++,b[d].className.indexOf&&-1!==b[d].className.indexOf("td_marker")&&c++,b[d]===a)return d+1-c},a.setMobileVersion=function(b){b?a.addClass(document.body,"mobile"):a.removeClass(document.body,"mobile")},a.hideEverything=function(a){parent.document.getElementById("trackduck").style.display="none",a&&setTimeout(a,100)},a.showEverything=function(){parent.document.getElementById("trackduck").style.display="block"}}(window.TrackDuck),function(a){a.Drag=function(){function b(a){var b={mouse:{start:"mousedown",move:"mousemove",end:"mouseup"},touch:{start:"touchstart",move:"touchmove",end:"touchend"}},c=-1!==a.type.indexOf("touch")?"touch":"mouse";return b[c]}function c(b,c,d){var e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("div");return e.setAttribute("data-td-resize-type","top"),f.setAttribute("data-td-resize-type","right"),g.setAttribute("data-td-resize-type","bottom"),h.setAttribute("data-td-resize-type","left"),e.className="td_outline_top",f.className="td_outline_right",g.className="td_outline_bottom",h.className="td_outline_left",e.style.width=c+"px",f.style.height=d+"px",g.style.width=c+"px",h.style.height=d+"px",e.style.zIndex=a.util.topZIndex+1,f.style.zIndex=a.util.topZIndex+1,g.style.zIndex=a.util.topZIndex+1,h.style.zIndex=a.util.topZIndex+1,b.appendChild(e),b.appendChild(f),b.appendChild(g),b.appendChild(h),{top:e,right:f,bottom:g,left:h}}function d(b){var c=document.createElement("div");c.setAttribute("data-td-resize-type","top_left"),c.className="td_outline_top_left",c.style.zIndex=a.util.topZIndex+1,b.appendChild(c);var d=document.createElement("div");d.setAttribute("data-td-resize-type","top_right"),d.className="td_outline_top_right",d.style.zIndex=a.util.topZIndex+1,b.appendChild(d);var e=document.createElement("div");e.setAttribute("data-td-resize-type","bottom_right"),e.className="td_outline_bottom_right",e.style.zIndex=a.util.topZIndex+1,b.appendChild(e);var f=document.createElement("div");return f.setAttribute("data-td-resize-type","bottom_left"),f.className="td_outline_bottom_left",f.style.zIndex=a.util.topZIndex+1,b.appendChild(f),{topLeft:c,topRight:d,bottomRight:e,bottomLeft:f}}function e(b,c){var d,e,f=Math.min(Math.abs(b),window.innerWidth),g=Math.min(Math.abs(c),window.innerHeight);0>b&&0>c?(d=j.startY-Math.abs(c),e=j.startX-Math.abs(b)):0>b?(d=j.startY,e=j.startX-Math.abs(b)):0>c?(d=j.startY-Math.abs(c),e=j.startX):(d=j.startY,e=j.startX),d=Math.max(d,0),e=Math.max(e,0),j.outline.element.style.width=f+"px",j.outline.element.style.height=g+"px",j.outline.element.style.top=d+"px",j.outline.element.style.left=e+"px",a.popup.setDimensions(e,d,f,g),j.resizableEl.top&&b&&(j.resizableEl.top.style.width=f+"px",j.resizableEl.right.style.height=g+"px",j.resizableEl.bottom.style.width=f+"px",j.resizableEl.left.style.height=g+"px"),a.event.fire("resized_selected_outline",{width:f,height:g,x:e,y:d})}function f(b){b=b||window.event,a.cancelDefault(b);var c=a.util.getEventClientXY(b).x-j.startX,d=a.util.getEventClientXY(b).y-j.startY;e(c,d)}function g(k){k=k||window.event,a.cancelDefault(k);var l=b(k);j.resizeContainer=document.createElement("div"),j.resizeContainer.className="td_outline",j.outline.element.appendChild(j.resizeContainer),j.resizableEl=c(j.resizeContainer),j.diagonalResizableEl=d(j.resizeContainer);var m=a.util.getEventClientXY(k).x-j.startX,n=a.util.getEventClientXY(k).y-j.startY;0===n&&0===m&&(n=150,m=300),m=Math.abs(m)>25?m:m>=0?25:-25,n=Math.abs(n)>25?n:n>=0?25:-25,e(m,n),j.startY=j.outline.element.offsetTop,j.startX=j.outline.element.offsetLeft,a.removeListener(l.end,document,g),a.removeListener(l.move,document,f),a.addListener(l.start,j.resizeContainer,h),a.addClass(j.outline.element,"td_move");var o=a.extend({},j.resizableEl,j.diagonalResizableEl);for(var p in o)a.addListener(l.start,o[p],i);j.outline.callback(j.outline.element)}function h(c){function d(b){b=b||window.event,a.cancelDefault(b),j.startY=a.util.getEventClientXY(b).y+a.util.getDocumentScrollXY().y-i+l,j.startX=a.util.getEventClientXY(b).x+a.util.getDocumentScrollXY().x-h+k,e(m,n)}function f(b){return b=b||window.event,a.cancelDefault(b),a.removeListener(o.move,g,d),a.removeListener(o.end,g,f),!1}c=c||window.event;var g=c.target,h=a.util.getEventClientXY(c).x+a.util.getDocumentScrollXY().x,i=a.util.getEventClientXY(c).y+a.util.getDocumentScrollXY().y,k=+j.outline.element.style.left.replace("px",""),l=+j.outline.element.style.top.replace("px",""),m=+j.outline.element.style.width.replace("px",""),n=+j.outline.element.style.height.replace("px",""),o=b(c);a.addListener(o.move,g,d),a.addListener(o.end,g,f)}function i(c){function d(b){switch(b=b||window.event,a.cancelDefault(b),g){case"top":var c=-1*(Math.max(0,a.util.getEventClientXY(b).y+a.util.getDocumentScrollXY().y)-i)+n;j.startY=a.util.getEventClientXY(b).y+a.util.getDocumentScrollXY().y-i+l,e(m,c);break;case"right":var d=a.util.getEventClientXY(b).x+a.util.getDocumentScrollXY().x-h+m;e(d,n);break;case"left":var d=-1*(Math.max(0,a.util.getEventClientXY(b).x+a.util.getDocumentScrollXY().x)-h)+m;j.startX=a.util.getEventClientXY(b).x+a.util.getDocumentScrollXY().x-h+k,e(d,n);break;case"bottom":var c=a.util.getEventClientXY(b).y+a.util.getDocumentScrollXY().y-i+n;e(m,c);break;case"top_left":var c=-1*(Math.max(0,a.util.getEventClientXY(b).y+a.util.getDocumentScrollXY().y)-i)+n,d=-1*(Math.max(0,a.util.getEventClientXY(b).x+a.util.getDocumentScrollXY().x)-h)+m;j.startY=a.util.getEventClientXY(b).y+a.util.getDocumentScrollXY().y-i+l,j.startX=a.util.getEventClientXY(b).x+a.util.getDocumentScrollXY().x-h+k,e(d,c);break;case"top_right":var c=-1*(Math.max(0,a.util.getEventClientXY(b).y+a.util.getDocumentScrollXY().y)-i)+n,d=a.util.getEventClientXY(b).x+a.util.getDocumentScrollXY().x-h+m;j.startY=a.util.getEventClientXY(b).y+a.util.getDocumentScrollXY().y-i+l,e(d,c);break;case"bottom_right":var c=a.util.getEventClientXY(b).y+a.util.getDocumentScrollXY().y-i+n,d=a.util.getEventClientXY(b).x+a.util.getDocumentScrollXY().x-h+m;e(d,c);break;case"bottom_left":var c=a.util.getEventClientXY(b).y+a.util.getDocumentScrollXY().y-i+n,d=-1*(Math.max(0,a.util.getEventClientXY(b).x+a.util.getDocumentScrollXY().x)-h)+m;j.startX=a.util.getEventClientXY(b).x+a.util.getDocumentScrollXY().x-h+k,e(d,c)}}function f(b){b=b||window.event,a.cancelDefault(b),a.removeListener(o.move,document,d),a.removeListener(o.end,document,f)}c=c||window.event,a.cancelDefault(c),c.stopPropagation();var g=c.target.getAttribute("data-td-resize-type"),h=a.util.getEventClientXY(c).x+a.util.getDocumentScrollXY().x,i=a.util.getEventClientXY(c).y+a.util.getDocumentScrollXY().y,k=+j.outline.element.style.left.replace("px",""),l=+j.outline.element.style.top.replace("px",""),m=+j.outline.element.style.width.replace("px",""),n=+j.outline.element.style.height.replace("px",""),o=b(c);a.addListener(o.move,document,d),a.addListener(o.end,document,f)}var j={};return j.getEventName=b,j.outline=function(c,d,e){a.cancelDefault(c),j.outline.event=c,j.outline.callback=d,j.startX=a.util.getEventClientXY(c).x+a.util.getDocumentScrollXY(parent).x,j.startY=a.util.getEventClientXY(c).y+a.util.getDocumentScrollXY(parent).y;var h=b(c);e.style.display="block",e.style.width=0,e.style.height=0,e.style.top="-10px",j.outline.element=e,j.resizableEl={},a.addListener(h.move,document,f),a.addListener(h.end,document,g),a.vars.documentX=c.screenX-c.clientX,a.vars.documentY=c.screenY-c.clientY},j.removeOutline=function(){j.resizeContainer&&(j.resizeContainer.parentNode.removeChild(j.resizeContainer),j.resizeContainer=null),a.removeListener("mousedown",j.outline.element,h),a.removeListener("touchstart",j.outline.element,h),j.outline.element&&a.removeClass(j.outline.element,"td_move")},j}()}(window.TrackDuck),function(a){a.testArea=function(a){return!!(a.relative&&a.relative.element&&void 0!==a.relative.x&&void 0!==a.x&&a.width&&a.screen&&a.scr)},a.StoredItemConstructor=a.ClassFactory("StoredItem",null,function(b){if(b.data&&b.data.area){if(a.testArea(b.data.area)===!1)return void a.error("Issue area test fail",b._id);this.data=b,this.initProperties(),this.visible=!0,a.issuesFilter.test(b)!==!0&&this.hide(),a.event.fire("loaded.new.task",b)}}),a.StoredItemConstructor.prototype.initProperties=function(){this.pageMarker=new a.PageMarker(this),this.listMarker=new a.ListMarker(this)},a.StoredItemConstructor.prototype.deleteProperties=function(){this.listMarker.remove(),this.pageMarker.remove(),delete this.listMarker,delete this.pageMarker},a.StoredItemConstructor.prototype.show=function(){a.util.setStyleImportant(this.pageMarker.element,"display","block"),this.listMarker.el.style.display="block",this.visible=!0},a.StoredItemConstructor.prototype.hide=function(){a.util.setStyleImportant(this.pageMarker.element,"display","none"),this.listMarker.el.style.display="none",this.visible=!1},a.StoredItemConstructor.prototype.getClass=function(){return a.getStatusClassById(this.data.status)},a.StoredItemConstructor.prototype.update=function(b){a.extend(this.data,b),this.pageMarker&&this.listMarker&&(this.pageMarker.update(),this.listMarker.update()),a.issuesFilter.test(b)?this.show():this.hide()},a.StoredItemConstructor.prototype.save=function(b){a.extend(this.data,b.getData()),this.data.tempInt&&(this.data.integrationData[this.data.tempInt.type].status=this.data.tempInt.value,delete this.data.tempInt),a.log("storedItemSave",this.data);var c=this;a.WebService("putPoints",c.data),a.variables.tempComment=b.elements.textarea.value},a.StoredItemConstructor.prototype.setRemoved=function(b){b&&a.extend(this.data,b.getData()),this.data.isRemoved=!0,a.WebService("putPoints",this.data)},a.StoredItemConstructor.prototype.comment=function(b,c){var d={message:b,issue:this.data._id,project:this.data.project,attachments:c||[]};a.WebService("commentIssue",d)},a.StoredItemConstructor.prototype.deleteComment=function(b){var c={_id:b,issue:this.data._id,project:this.data.project};a.WebService("deleteComment",c)},a.StoredItemConstructor.prototype.cancel=function(a){a.deatach()};var b=a.ClassFactory("NewItem",null,function(b,c,d,e){var f=this;this.data=a.extend({},a.issueTemplate),this.element=b,this.ui=c,this.type=d,this.mediaType=e||"image/jpeg",this.ui.attach({mediaType:f.mediaType},this.data,this),"image/gif"===this.mediaType?(a.popup.hide(),a.addListener("click",c.elements.videoOverflow,function g(){var b=window.confirm(a.t("CONFIRM_VIDEO_NO_SAVE"));b&&(a.removeListener("click",c.elements.videoOverflow,g),f.cancel(f.ui))})):(f.cancelListener=function(b){("click"===b.type||"keydown"===b.type&&27===b.keyCode)&&(f.cancel(f.ui),a.popup.hide(),a.removeListener("click",a.popup.overlay,f.cancelListener),a.removeListener("keydown",window,f.cancelListener))},a.addListener("click",a.popup.overlay,f.cancelListener),a.addListener("keydown",window,f.cancelListener)),a.event.fire("created_new_issue")});b.prototype.cancel=function(b){"image/gif"===this.mediaType&&(a.removeListener("beforeunload",window,a.videoFeedback.recordingCloseWarning),a.removeClass(document.body,"td_overflow_hidden"),b.elements.videoCont.style.display=""),this.element.style.display="none",a.ui.bar.show(),b.deatach(),a.Drag.removeOutline(),a.vars.newIssueData=null,delete this},b.prototype.save=function(b,c){function d(){a.removeClass(a.ui.bar.elements.newVideo,"td_bar_video_uploading"),a.ui.bar.elements.videoProgress.style.width=0}function e(b){a.ui.bar.elements.videoProgress.style.width=b+"%"}var f=this;if(this.data.data={area:a.calculateOutlineElementArea(this.element)},a.extend(this.data,{attachments:c},b.getData()),this.data.tempInt&&(this.data.integrationData={},this.data.integrationData[this.data.tempInt.type]={status:this.data.tempInt.value},delete this.data.tempInt),this.data.customData=a.customData,a.log("NewItem.save",this.data,this.mediaType),b.deatach(),a.popup.show(),"image/jpeg"===f.mediaType){f.element.style.display="none";var g=function(b,c){f.data.data.area.scr={url:b,size:{width:f.data.data.area.width,height:f.data.data.area.height},format:"PNG"},f.data.data.area.mediaType=f.mediaType,a.base64Images[b]=c,a.WebService("postPoints",f.data),a.ui.bar.show(),"manager"===f.type?a.popup.hide():"anon"===f.type&&a.popup.show(a.t("THANK_FEEDBACK")),a.event.fire("saved_new_issue",f.data)};a.vars.newIssueData?(g(a.vars.newIssueData.imgUrl,a.vars.newIssueData.base64),a.vars.newIssueData=null):a.saveScreenshotAndGetUrl(f.data.data.area,g),a.removeListener("click",a.popup.overlay,f.cancelListener),a.removeListener("keydown",window,f.cancelListener)}else if("image/gif"===f.mediaType){a.addClass(a.ui.bar.elements.newVideo,"td_bar_video_uploading"),a.ui.bar.elements.videoProgress.style.width="0%";var h=a.getMediaMetadata(f.data.data.area),i=a.videoFeedback.save(a.vars.videoBlob,a.pId,d,e,h);f.data.data.area.scr={url:a.url.videoCDN+i,size:{width:f.data.data.area.width,height:f.data.data.area.height},format:"GIF"},f.data.data.area.mediaType=f.mediaType,a.WebService("postPoints",f.data),a.vars.videoBlobsUrls[a.url.videoCDN+i]=f.element.getAttribute("data-url"),f.element.removeAttribute("data-url"),a.popup.hide(),a.event.fire("saved_new_issue",f.data),a.log("video done",f.data),a.removeClass(document.body,"td_overflow_hidden")}a.Drag.removeOutline()},a.NewItem=b}(window.TrackDuck),function(a){var b=a.ClassFactory("ObjerctStorage",null,function(a,b){this.wrap=a?function(b){return new a(b)}:function(a){return a},this.converter=b?b:function(a){return a},this.data={}});b.prototype.$push=function(a){var b=this.converter(a);if(b&&this.data){var c=this.data[a._id];c?(c.update?c.update(b):this.data[a._id]=this.wrap(b),this.fireCb("update",b)):this.data[a._id]=this.wrap(b)}},b.prototype["delete"]=function(a){if(this.data){var b=this.data[a._id];delete this.data[a._id],this.fireCb("delete",b)}},b.prototype.add=function(a){this.$push(a),this.fireCb("add")},b.prototype.clear=function(){this.selected=null,delete this.data,this.fireCb("clear")},b.prototype.init=function(a,b){b||(this.clear(),this.data={});for(var c=0;c<a.length;c++)this.$push(a[c]);this.isLoaded=!0,this.fireCb("init",this.data)},b.prototype.bulkAdd=function(a){for(var b=0;b<a.length;b++)this.$push(a[b]);this.fireCb("add")},b.prototype.select=function(a){this.selected=a,this.fireCb("select",a)},b.prototype.unSelect=function(a){this.selected=null,this.fireCb("unSelect",a)},b.prototype.count=function(){return a.log("Objects count",Object.keys(this.data).length),Object.keys(this.data).length},b.prototype.add=function(a){this.$push(a),this.fireCb("add",a)},b.prototype.emit=function(a,b){this.fireCb(a,b)},b.prototype.bulkAdd=function(a){for(var b=0;b<a.length;b++)this.$push(a[b]);this.fireCb("add",this.data)},a.dataStorage={MarkedDomItems:new b(a.StoredItemConstructor),IssueComments:new b,Contributors:new b,IssueStatuses:new b,ContributorRoles:new b,Project:new b,User:new b},a.loadContributors=function(){a.WebService("getContributors")},a.getContributorById=function(b,c,d){for(var e in a.dataStorage.Contributors.data)if(a.dataStorage.Contributors.data[e]._id===b&&void 0!==b)return c?a.dataStorage.Contributors.data[e][c]:a.dataStorage.Contributors.data[e];return void 0!==d?d:a.user?c?a.getCurrentContributor()[c]:a.getCurrentContributor():c?"":{}},a.getCurrentContributor=function(){for(var b in a.dataStorage.Contributors.data)if(a.dataStorage.Contributors.data[b].user===a.user)return a.dataStorage.Contributors.data[b];return{}},a.userHaveRole=function(b){if(!a.user)return!1;var c=a.getRoleByName(b);return a.getCurrentContributor().role<=c._id},a.getRoleByName=function(b){for(var c in a.dataStorage.ContributorRoles.data)if(a.dataStorage.ContributorRoles.data[c].name===b)return a.dataStorage.ContributorRoles.data[c];a.error("error role not found, by name",b)},a.getRoleById=function(b){for(var c in a.dataStorage.ContributorRoles.data)if(a.dataStorage.ContributorRoles.data[c]._id===b)return a.dataStorage.ContributorRoles.data[c];a.error("error role not found, by id",b)},a.getStatusByName=function(b){for(var c in a.dataStorage.IssueStatuses.data)if(a.dataStorage.IssueStatuses.data[c].name===b)return a.dataStorage.IssueStatuses.data[c];a.error("error status not found, by name",b)},a.loadIssueStatuses=function(){a.dataStorage.IssueStatuses.bulkAdd([{name:"New",translated:a.t("NEW"),_id:0},{name:"In progress",translated:a.t("IN_PROGRESS"),_id:10},{name:"Resolved",translated:a.t("RESOLVED"),_id:20},{name:"Closed",translated:a.t("CLOSED"),_id:30}])},a.loadContributorRoles=function(){a.dataStorage.ContributorRoles.bulkAdd([{name:"Admin",translated:a.t("ADMIN"),_id:10},{name:"Contributor",translated:a.t("CONTRIBUTOR"),_id:20},{name:"Reporter",translated:a.t("REPORTER"),_id:30}])},a.demoLoadContributors=function(){var b=[{_id:"01",email:"demouser@trackduck.com",gravatar:"default",name:"Demo User",project:0,role:10,status:10,user:"01"}];a.dataStorage.Contributors.bulkAdd(b),a.dataStorage.Contributors.fireCb("init",b)},a.demoLoadAllPoints=function(){var b=[];a.dataStorage.MarkedDomItems.bulkAdd(b),a.dataStorage.MarkedDomItems.fireCb(b)},a.loadAllPoints=function(){a.WebService("getPoints",{filters:{status:[0,10,20,30]}}),a.variables.completedLoaded=!0},a.loadNotCompetedPoints=function(){a.WebService("getPoints",{filters:{status:[0,10,20]}})},a.loadCompletedPoints=function(){a.WebService("getPoints",{filters:{status:[30]}}),a.variables.completedLoaded=!0},a.getStatusClassById=function(a){switch(+a){default:case 0:return"td_status_active";case 30:case 3:return"td_status_completed"}},a.loaded={data:{MarkedDomItems:!1,Contributors:!1},setK:function(b){this.data[b]=!0,a.event.fire("socket.init.done."+b),this.test()&&this.onLoaded()},test:function(){for(var a in this.data)if(this.data.hasOwnProperty(a)&&this.data[a]===!1)return!1;return!0},onLoaded:function(){a.removeClass(a.ui.bar.elements.root,"td_bar_loading"),a.event.fire("socket.init.done")}},a.dataStorage.MarkedDomItems.regCb("init",function(){a.loaded.setK("MarkedDomItems")}),a.dataStorage.Contributors.regCb("init",function(){a.loaded.setK("Contributors")}),a.issuesFilter={setShowCompleted:function(b){return a.localStorage.set("tdFilterCompleted",+b)},showCompleted:function(){var b=a.localStorage.get("tdFilterCompleted");return b?+b:0},testCompleted:function(a){return 0===this.showCompleted()?30!==+a.status:30===+a.status},addContributor:function(b){return a.localStorage.set("tdFilterContributor",[b])},getContributor:function(){var b=a.localStorage.get("tdFilterContributor");return b?b.split(","):[]},removeContributor:function(b){var c=this.getContributor();return c.splice(c.indexOf(String(b)),1),a.localStorage.set("tdFilterContributor",c)},testContributor:function(a){var b=a.assigneeContributor||null,c=this.getContributor();return c.length&&-1===c.indexOf(String(b))?!1:!0},testRemoved:function(a){return!a.isRemoved},setAssignedToMe:function(b){return a.localStorage.set("tdFilterAssingnedToMe",+b)},isAssignedToMe:function(){return!!+a.localStorage.get("tdFilterAssingnedToMe")},testAssignedToMe:function(b){return this.isAssignedToMe()?a.getCurrentContributor()._id===b.assigneeContributor:!0},setCreatedByMe:function(b){return a.localStorage.set("tdFilterCreatedByMe",+b)},isCreatedByMe:function(){return!!+a.localStorage.get("tdFilterCreatedByMe")},testCreatedByMe:function(b){return this.isCreatedByMe()?a.getCurrentContributor()._id===b.createdByContributor:!0},testRole:function(b){return a.userHaveRole("Contributor")?!0:b.createdByContributor===a.getCurrentContributor()._id},test:function(a){return this.testCompleted(a)&&this.testContributor(a)&&this.testRemoved(a)&&this.testAssignedToMe(a)&&this.testCreatedByMe(a)&&this.testRole(a)},clearAll:function(){this.setCreatedByMe(0),this.setAssignedToMe(0),this.setShowCompleted(0),this.getContributor().length&&this.removeContributor(this.getContributor()[0])},isAny:function(){return this.isCreatedByMe()||this.isAssignedToMe()||this.showCompleted()||this.getContributor().length}},a.applyFiltersToMarkers=function(b){for(var c in a.dataStorage.MarkedDomItems.data)if(a.dataStorage.MarkedDomItems.data.hasOwnProperty(c)){var d=a.dataStorage.MarkedDomItems.data[c];if(void 0===d.data)continue;var e=a.issuesFilter.test(d.data)===!0;e===!0&&d.visible===!1?d.show():e===!1&&d.visible===!0&&d.hide()}b&&b()}}(window.TrackDuck),function(a){var b=a.ClassFactory("CollectionSocket",null,function(a,b){this.path=a,this.collection=b});b.prototype.connect=function(b){var c=this;this.socket=a.io.connect(a.url.socket+"/socket"+this.path).on("connect",b).on("get",function(b){var d=b.data,e="/projects/issues"===c.path;"/projects/issues"===c.path&&a.dataStorage.Contributors.isLoaded!==!0?a.dataStorage.Contributors.regCb("init",function(){c.collection.init(d,e)}):c.collection.init(d,e)}).on("add",function(a){var b=a.data;"[object Array]"===Object.prototype.toString.call(b)?c.collection.bulkAdd(b):c.collection.add(b)}).on("update",function(a){var b=a.data;c.collection.add(b)}).on("getInvitationUrls",function(a){var b=a.data;c.collection.emit("getInvitationUrls",b)}).on("delete",function(a){var b=a.data;c.collection["delete"](b)}).on("error",function(b){b&&402===b.status?(a.extensionsUI.showInfo("limit"),a.vars.subscriptionLimit=!0):(a.error("Socket server error",{resp:b}),setTimeout(a.domain.reloadTrackDuck,999))})},b.prototype.extendMessage=function(b){return b=b?b:{},b.referer=decodeURIComponent(a.getPageUrlForQuabler()),b.project=a.pId,b.team=a.teamId,b},b.prototype.get=function(a){var b=this.extendMessage(a);this.socket.emit("get",b)},b.prototype.add=function(a){var b=this.extendMessage(a);this.socket.emit("add",b)},b.prototype.update=function(a){var b=this.extendMessage(a);this.socket.emit("update",b)},b.prototype["delete"]=function(a){var b=this.extendMessage(a);this.socket.emit("delete",b)},b.prototype.emit=function(a,b){var c=this.extendMessage(b);this.socket.emit(a,c)},a.socketTransport=function(b,c){switch(b){case"getPoints":c=c||{},c.customData=a.customData,a.socket.issues.get(c);break;case"postPoints":a.socket.issues.add(c),setTimeout(function(){if(!a.vars.subscriptionLimit){var b=a.dataStorage.MarkedDomItems.data;for(var d in b)if(b.hasOwnProperty(d)&&b[d].data.data.area.scr.url===c.data.area.scr.url&&b[d].data.createdBy===a.user)return;a.error("Socket.issues.add no response in 3s",{srcUrl:c.data.area.scr.url}),a.domain.reloadTrackDuck()}},3e3);break;case"putPoints":a.socket.issues.update(c);break;case"getContributors":a.socket.contributors.get(c);break;case"getIssueStatus":break;case"commentIssue":a.socket.issueComments.add(c);break;case"getIssueComments":a.socket.issueComments.get(c);break;case"deleteComment":a.socket.issueComments["delete"](c);break;case"getImgUrl":c.type="POST",c.url=a.url.imageSrc,c.contentType="application/json",c.withCredentials=!0,a.log("Sending base64 to server",c),a.ajax(c);break;case"switchUrl":a.ioConnect.emit("switchUrl",{url:a.getPageUrlForQuabler()});break;case"sendInvite":a.socket.contributors.add({email:c,role:30,autoInvite:!0});break;case"boardingUpdate":void 0===a.socket.user.socket&&a.socket.user.connect(),a.socket.user.emit("boardingUpdate",{_id:a.pId,user:a.user,type:"toolbar",completed:c.completed,step:c.step});break;case"getInvitationUrls":a.dataStorage.Contributors.regCb("getInvitationUrls",c.callback),a.socket.contributors.emit("getInvitationUrls",{team:c.team})}},a.demoTransport=function(b,c){switch(b){case"postPoints":c.createdOn=new Date,c.modifiedOn=new Date,c.createdByContributor="01",c.assigneeContributor="01",c._id=(new Date).getTime().toString(),c.number=a.dataStorage.MarkedDomItems.count()+1,c.os={family:"Demo Windows"},c.ua={family:"Chrome",major:"33"},a.dataStorage.MarkedDomItems.add(c);break;case"putPoints":a.dataStorage.MarkedDomItems.data[c._id].update(c);break;case"commentIssue":c.date=new Date,a.variables.issueComments?a.variables.issueComments.push(c):a.variables.issueComments=[c],a.dataStorage.IssueComments.add(c);break;case"getIssueComments":var d=[];a.variables.issueComments=a.variables.issueComments||[];for(var e=0;e<a.variables.issueComments.length;e++)a.variables.issueComments[e].issue===a.dataStorage.MarkedDomItems.selected._id&&d.push(a.variables.issueComments[e]);a.dataStorage.IssueComments.init(d)}},a.anonDemoTransport=function(){},a.anonTransport=function(b,c){switch(b){case"postPoints":c.team=a.teamId;var d={};d.type="POST",d.url=a.url.API+"/project/"+a.pId+"/issue?"+a.domain.getRequestSourceQuery(),d.data=JSON.stringify(c),a.anonTransport.AJAX(d);break;case"getImgUrl":var d=c;d.type="POST",d.url=a.url.imageSrc,a.anonTransport.AJAX(d)}},a.anonTransport.AJAX=function(b){var c={contentType:"application/json",withCredentials:!0,beforeSend:function(c){c.setRequestHeader("X-Q-Auth",a.pId),c.setRequestHeader("X-Q-Public",a.pId),c.setRequestHeader("X-Q-Referer",decodeURIComponent(a.getPageUrlForQuabler())),b.beforeSend&&b.beforeSend()}};a.extend(c,b),a.ajax(c)},a.setWebService=function(c){switch(c){case"manager":a.WebService=a.socketTransport;var d={query:"project="+a.pId+"&url="+a.getPageUrlForQuabler()+a.domain.getRequestSourceQuery()};a.ioConnect=a.io.connect(a.url.socket,d).on("switchUrl",function(){a.WebService("getPoints")}),a.socket.contributors=new b("/teams/contributors",a.dataStorage.Contributors),a.socket.issues=new b("/projects/issues",a.dataStorage.MarkedDomItems),a.socket.project=new b("/projects",a.dataStorage.Project),a.socket.user=new b("/user",a.dataStorage.User),a.socket.issueComments=new b("/projects/issues/comments",a.dataStorage.IssueComments),a.socket.issueComments.extendMessage=function(c){return a.dataStorage.MarkedDomItems.selected||a.error("MarkedDomItems.selected is null",c),c=b.prototype.extendMessage.call(this,c),c.issue=a.dataStorage.MarkedDomItems.selected._id,c},a.socket.contributors.connect(),a.socket.issues.connect(),a.socket.project.connect(),a.socket.issueComments.connect();break;case"demo":a.WebService=a.demoTransport;break;case"anonDemo":a.WebService=a.anonDemoTransport;break;case"anon":a.WebService=a.anonTransport;break;default:a.WebService=function(){},a.error("SetWebService fail "+c)}},a.uploadToCDN=function(){function b(b,c,d){var e=new XMLHttpRequest;e.open("post",a.url.userFileUpload,!0),e.withCredentials=!0,e.timeout=15e3,e.onreadystatechange=function(){4===e.readyState&&(200===e.status?a.log("Save file ok",e.responseText):200!==e.status&&(a.error("Save user file to CDN error",e.responseText,e.status),window.alert("File upload failed. Please make sure that file size is less than 4Mb and try again. "+e.responseText)),c&&c(e.status,e.responseText,h))},d&&(e.upload.onprogress=function(a){a.lengthComputable&&d(a.loaded/a.total*100)});var f=(a.pId?a.pId:Math.floor(1e8*Math.random()))+"-"+(new Date).getTime()+"-"+b.name.replace(/[ =&#]/g,"-"),g=new FormData;g.append("file_to_upload",b,f),e.send(g);var h=a.url.userFileCDN+f;return h}return{userFile:b}}()}(window.TrackDuck),function(a){var b={options:{visible:!0,listVisible:!1,inviteVisible:!1,available:!1},elements:{},events:{},init:function(){this.options.available=!0;var b=document.createElement("div");b.className="td_bar td_bar_loading",b.innerHTML=a.templates.bar_main,b.style.zIndex=a.util.topZIndex+3;var c=this.position.g();b.style.left=0;var d={width:"300px"};d[c.k]=c.v,a.frame.setDefaultSize(d),a.extensionsUI.visible&&a.frame.setFullSize(),this.elements=a.util.attachElements(b),this.elements.root=document.body.appendChild(b),this.elements.contributors={},this.bindEvents(),"false"===a.localStorage.get("tdShowToolbar")&&this.hide(),a.config.whitelabel&&a.addClass(this.elements.logo,"td_whitelabel"),this.elements.showCompleted.textContent=a.t("SHOW_COMPLETED"),this.elements.showAssignedToMe.textContent=a.t("ASSIGNED_TO_ME"),this.elements.showCreatedByMe.textContent=a.t("CREATED_BY_ME"),a.issuesFilter.showCompleted()&&a.addClass(this.elements.showCompleted,"td_active"),a.issuesFilter.isAssignedToMe()&&a.addClass(this.elements.showAssignedToMe,"td_active"),a.issuesFilter.isCreatedByMe()&&a.addClass(this.elements.showCreatedByMe,"td_active"),this.checkClearFilter()},showIssueCount:function(){if(b.options.available!==!1){var c=0;for(var d in a.dataStorage.MarkedDomItems.data)a.dataStorage.MarkedDomItems.data[d].visible===!0&&c++;b.elements.issueCount.textContent=c,b.elements.issueCount.style.display=c>0?"block":"none"}},show:function(){this.options.available!==!1&&(a.markersContainerElement.style.display="block",a.removeClass(b.elements.root,"td_bar_hidden"),a.onboarding&&a.onboarding.completed===!1&&(a.onboarding.elements.root.style.display="block"),a.frame.setDefaultSize({width:"300px"}),b.options.visible=!0)},hide:function(){this.options.available!==!1&&(this.hideList(!0),this.hideInvite(!0),a.markersContainerElement.style.display="none",a.addClass(this.elements.root,"td_bar_hidden"),b.elements.barControls.style.display="none",setTimeout(function(){b.elements.barControls.style.display="block"
},1500),a.onboarding&&(a.onboarding.elements.root.style.display="none"),a.frame.setDefaultSize({width:"75px"}),b.options.visible=!1)},toggle:function(){b.options.visible===!0?(b.hide(),a.localStorage.set("tdShowToolbar",!1)):(b.show(),a.localStorage.set("tdShowToolbar",!0))},hideElement:function(){b.elements.root&&(b.elements.root.style.display="none")},showElement:function(){b.elements.root&&(b.elements.root.style.display="block")},position:{g:function(){var b=(a.localStorage.get("tdToolbarPosition")||"left:0").split(":");return{k:b[0],v:b[1]}},s:function(b){return a.localStorage.set("tdToolbarPosition",b)},moveStart:function(c){c.preventDefault();var d=a.frame.getElement().offsetLeft;b.elements.root.style.right="",b.elements.root.style.left=d+"px",b.elements.listAnim.style.right="",b.elements.listAnim.style.left=d+"px",a.frame.setFullSize(),b.position.startPos=a.util.getEventClientXY(c).x,b.position.startPosEl=b.elements.root.offsetLeft,a.addListener(a.Drag.getEventName(c).move,document,b.position.move),a.addListener(a.Drag.getEventName(c).end,document,b.position.moveEnd)},move:function(c){c.preventDefault();var d=Math.max(0,a.util.getEventClientXY(c).x-b.position.startPos);d=Math.min(document.documentElement.clientWidth-300,d),b.elements.root.style.left=d+"px",b.elements.listAnim.style.left=d+"px"},moveEnd:function(c){c.preventDefault();var d=b.position.startPosEl===b.elements.root.offsetLeft,e=b.elements.root.offsetLeft,f="left";e===document.documentElement.clientWidth-300&&(f="right",e=0),b.elements.root.style.left="",b.elements.listAnim.style.left="",b.elements.root.style.right="",b.elements.listAnim.style.right="",b.elements.root.style[f]="0px",b.elements.listAnim.style[f]="0px",b.position.s(f+":"+e+"px");var g={left:""};g[f]=e+"px",a.frame.setDefaultSize(g),d&&b.toggle(),a.removeListener(a.Drag.getEventName(c).move,document,b.position.move),a.removeListener(a.Drag.getEventName(c).end,document,b.position.moveEnd)}},bindEvents:function(){a.addListener("click",this.elements.logo,function(a){a.preventDefault()}),a.addListener("mouseover",this.elements.root,function(){b.options.visible===!1&&"100%"!==a.frame.getElement().style.width&&(a.frame.getElement().style.width="300px")}),a.addListener("mouseleave",this.elements.root,function(){b.options.visible===!1&&"100%"!==a.frame.getElement().style.width&&a.frame.setDefaultSize()}),a.addListener("mousedown",this.elements.logo,b.position.moveStart),a.addListener("touchstart",this.elements.logo,b.position.moveStart),a.addListener("click",this.elements.hide,function(c){c.preventDefault(),b.options.visible!==!0&&(b.show(),a.localStorage.set("tdShowToolbar",!0)),b.options.listVisible!==!0?b.showList():b.hideList()}),a.addListener("click",this.elements.newIssue,function(c){c.preventDefault(),b.hideElement(),a.markersContainerElement.style.display="none",a.showStartSelectArea(a.CustomOutlineSelect,a.ui.newBugWindow.elements.root,b.show.bind(b)),a.event.fire("click_new_issue")}),a.addListener("click",this.elements.newVideo,function(c){c.preventDefault(),a.addClass(b.elements.barControls,"td_video_recording"),a.resourceLoader.loadScript(a.url.jsVideo,function(){a.videoFeedback.start(function(c,d,e){a.removeClass(b.elements.barControls,"td_video_recording"),a.customOutlineSelectVideo(c,d,e)},function(c,d){a.log("Video error",c),a.removeClass(b.elements.barControls,"td_video_recording"),d&&a.popup.show('Please copy this URL to your browser address bar: <span class="td_code">chrome://flags/#enable-usermedia-screen-capture</span> after that you will need to relaunch your browser. *This action is required only on the first time to enable getUserMedia flag')},function(a){b.elements.endVideoTime.textContent=a})})}),a.addListener("click",this.elements.endVideo,function(b){b.preventDefault(),a.videoFeedback.stop()}),a.addListener("click",this.elements.showCompleted,function(c){c.preventDefault(),a.toggleClass(this,"td_active"),1===a.issuesFilter.showCompleted()?a.issuesFilter.setShowCompleted(0):(a.issuesFilter.setShowCompleted(1),a.variables.completedLoaded!==!0&&a.loadCompletedPoints()),a.applyFiltersToMarkers(),b.showIssueCount(),b.checkClearFilter()}),a.addListener("click",this.elements.showAssignedToMe,function(c){c.preventDefault(),a.toggleClass(this,"td_active"),a.issuesFilter.setAssignedToMe(!a.issuesFilter.isAssignedToMe()),a.applyFiltersToMarkers(),b.showIssueCount(),b.checkClearFilter()}),a.addListener("click",this.elements.showCreatedByMe,function(c){c.preventDefault(),a.toggleClass(this,"td_active"),a.issuesFilter.setCreatedByMe(!a.issuesFilter.isCreatedByMe()),a.applyFiltersToMarkers(),b.showIssueCount(),b.checkClearFilter()}),a.addListener("click",this.elements.clearFilters,function(c){c.preventDefault(),a.issuesFilter.clearAll(),a.applyFiltersToMarkers(),b.showIssueCount(),b.elements.clearFilters.style.display="none",a.removeClass(b.elements.showCompleted,"td_active"),a.removeClass(b.elements.showAssignedToMe,"td_active"),a.removeClass(b.elements.showCreatedByMe,"td_active");var d=b.elements.list.querySelectorAll(".td_bar_person");for(var e in d)d.hasOwnProperty(e)&&"object"==typeof d[e]&&a.removeClass(d[e],"td_active");a.removeClass(b.elements.list,"td_bar_4more_disable")})},showList:function(){b.hideInvite(!0),a.frame.setDefaultSize({height:"100%"}),b.elements.listCont.style.display="block",b.elements.inviteCont.style.dispaly="none",b.options.listVisible=!0,a.addClass(b.elements.hide,"td_active"),a.addClass(b.elements.root,"td_bar_show_list"),a.addListener("click",parent.document,this.clickOnDocumentHideList)},hideList:function(c){b.options.listVisible=!1,a.removeClass(b.elements.hide,"td_active"),a.removeClass(b.elements.root,"td_bar_show_list"),a.removeListener("click",parent.document,this.clickOnDocumentHideList),c?a.frame.setDefaultSize({height:"60px"}):setTimeout(function(){a.frame.setDefaultSize({height:"60px"})},250)},checkClearFilter:function(){b.elements.clearFilters.style.display=a.issuesFilter.isAny()?"block":"none"},createListIssue:function(b,c,d,e,f,g){var h=document.createElement("li"),i=document.createElement("a");i.className="td_bar_issue "+c,"image/gif"===g&&(i.className+=" td_type_video"),i.setAttribute("href","#"),h.appendChild(i);var j=document.createElement("span");j.appendChild(document.createTextNode(f+" - "+b)),j.className="td_bar_issue_text",i.appendChild(j);var k=document.createElement("span");k.className="td_bar_time",k.textContent=" "+a.formatDate.nice(d),i.appendChild(k);var l=document.createElement("span");return l.className="td_bar_priority"+(+e?" td_active":""),i.appendChild(l),h},insertListIssue:function(a,c,d){for(var e,f,g=b.elements.contributors[c].childNodes,h="",i=0;i<g.length;i++)d>g[i].tdModifiedDate&&h<g[i].tdModifiedDate&&(e=i,h=g[i].tdModifiedDate);return f=void 0!==e?b.elements.contributors[c].insertBefore(a,g[e]):b.elements.contributors[c].appendChild(a),f.tdModifiedDate=d,f},initListContributor:function(c,d,e,f){if(a.ui.bar.elements.contributors[c])return a.ui.bar.elements.contributors[c];var g=document.createElement("li"),h=this.createListContributor(c,d,e,f);g.appendChild(h);var i=document.createElement("ul");g.appendChild(i);var j=document.createElement("span");return j.className="td_bar_4more_click",a.addListener("click",j,b.clickOn4more),g.appendChild(j),a.ui.bar.elements.list.appendChild(g),a.ui.bar.elements.contributors[c]=i},createListContributor:function(c,d,e,f){c=c||null;var g=document.createElement("a");g.className="td_bar_person",a.issuesFilter.getContributor().length&&a.issuesFilter.testContributor({assigneeContributor:c})?(g.className="td_bar_person td_active",a.addClass(b.elements.list,"td_bar_4more_disable")):g.className="td_bar_person",g.setAttribute("href","#"),g.setAttribute("data-td-contributor",c),a.addListener("click",g,b.clickOnContributor);var h=document.createElement("span");h.appendChild(document.createTextNode(d)),h.className="td_bar_person_name",g.appendChild(h);var i=document.createElement("span");i.appendChild(document.createTextNode(e)),i.className="td_bar_person_role",g.appendChild(i);var j=document.createElement("img");return j.src="//gravatar.com/avatar/"+f+"?s=34&d=mm",j.setAttribute("data-html2canvas-ignore",""),j.className="td_bar_avatar",g.appendChild(j),g},clickOn4more:function(b){a.toggleClass(b.target.parentNode,"td_bar_4more_show")},clickOnContributor:function(c){c.preventDefault();var d=null!==c.target.getAttribute("data-td-contributor")?c.target:c.target.parentNode,e=d.getAttribute("data-td-contributor"),f=-1!==d.className.indexOf("td_active"),g=b.elements.list.querySelectorAll(".td_bar_person");for(var h in g)g.hasOwnProperty(h)&&"object"==typeof g[h]&&a.removeClass(g[h],"td_active");f===!1?(a.addClass(d,"td_active"),a.issuesFilter.addContributor(e),a.addClass(b.elements.list,"td_bar_4more_disable")):(a.issuesFilter.removeContributor(e),a.removeClass(b.elements.list,"td_bar_4more_disable")),a.applyFiltersToMarkers(function(){b.elements.list.scrollTop=d.offsetTop-d.offsetHeight}),b.showIssueCount(),b.checkClearFilter()},clickOnDocumentHideList:function(c){var d=a.frame.getElement().offsetLeft;(c.clientX<d||c.clientX>d+300)&&(b.hideList(),b.hideInvite())},showInvite:function(){b.hideList(!0),a.frame.setDefaultSize({height:"100%"}),a.addListener("click",parent.document,this.clickOnDocumentHideList),a.addClass(b.elements.root,"td_bar_show_list"),a.addClass(b.elements.share,"td_active"),b.options.inviteVisible=!0,b.elements.listCont.style.display="none",b.elements.inviteCont.style.dispaly="block",b.elements.inviteCont.innerHTML=a.templates.bar_show_invite;var c=b.elements.inviteCont.querySelector(".js_td_e_info");c.setAttribute("href",a.url.dashboard+"/project/"+a.pId+"/settings/domains"),c.textContent=a.t("CHANGE_STATUS_INFO"),b.elements.inviteInput=b.elements.inviteCont.querySelector(".js_td_e_input"),b.elements.inviteInput.setAttribute("placeholder",a.t("EMAIL"));var d=b.elements.inviteCont.querySelector(".td_bar_s_i");a.addListener("click",d,b.sendInvite);var e=b.elements.inviteCont.querySelector(".td_bar_invite_s_info");e.textContent=a.t("SHARE_LINK_PUBLIC");var f=b.elements.inviteCont.querySelector(".td_bar_invite_s_input");a.addListener("click",f,function(){this.selectionStart===this.selectionEnd&&this.select()}),a.domain.getInviteUrl(function(a){f.value=a}),b.elements.inviteCont.querySelector(".td_bar_s_update").style.display="none"},hideInvite:function(c){b.options.inviteVisible=!1,a.removeClass(b.elements.share,"td_active"),a.removeClass(b.elements.root,"td_bar_show_list"),a.removeListener("click",parent.document,this.clickOnDocumentHideList),b.elements.inviteCont.innerHTML="",c?a.frame.setDefaultSize({height:"60px"}):setTimeout(function(){a.frame.setDefaultSize({height:"60px"})},250)},sendInvite:function(c){c.preventDefault();var d=b.elements.inviteInput.value;/\S+@\S+\.\S+/.test(d)?(a.WebService("sendInvite",d),b.inviteMessage(a.t("INVITE_SENDED"))):b.elements.inviteInput.style.background="rgb(93, 37, 37)"},inviteMessage:function(c){var d=b.elements.inviteCont.querySelector(".td_bar_invite_email");d.innerHTML="";var e=document.createElement("h3");e.textContent=c,d.appendChild(e);var f=document.createElement("a");f.className="td_bar_s_c",f.style.position="static",f.style.marginTop="15px",f.setAttribute("href","#"),a.addListener("click",f,function(a){a.preventDefault(),b.hideInvite()}),d.appendChild(f),d.style.textAlign="center"}};a.ui.bar=b,a.ListMarker=function(b){this.marker=b,a.variables.contributorsLoaded===!0?this.setElement():this.el=null},a.ListMarker.prototype.setElement=function(){var c=this.marker,d=c.data.assigneeContributor||0;if(void 0===a.ui.bar.elements.contributors[d])if(0!==d&&a.getContributorById(d).role){var e=a.getContributorById(d);a.ui.bar.initListContributor(d,e.name,a.getRoleById(e.role).translated,e.gravatar)}else a.ui.bar.initListContributor(d,a.t("NOT_ASSIGNED"),"","default");5===a.ui.bar.elements.contributors[d].children.length&&a.addClass(a.ui.bar.elements.contributors[d],"td_bar_4more");var f=a.ui.bar.createListIssue(c.data.description,c.getClass(),c.data.createdOn,c.data.priority,c.data.number,c.data.data.area.mediaType);a.addListener("click",f.querySelector("a"),function(a){a.preventDefault(),b.hideList(!0),c.pageMarker.scrollToTop(),c.pageMarker.showIssueWindow()}),this.el=a.ui.bar.insertListIssue(f,d,c.data.modifiedOn)},a.ListMarker.prototype.update=function(){this.remove(),this.setElement()},a.ListMarker.prototype.remove=function(){this.el.parentNode.removeChild(this.el)},a.dataStorage.Contributors.regCb("init",function(){a.variables.contributorsLoaded=!0;for(var c in a.dataStorage.MarkedDomItems.data)a.dataStorage.MarkedDomItems.data[c].listMarker&&null===a.dataStorage.MarkedDomItems.data[c].listMarker.el&&a.dataStorage.MarkedDomItems.data[c].listMarker.setElement();a.userHaveRole("Admin")?a.addListener("click",b.elements.share,function(c){c.preventDefault(),c.stopPropagation(),b.options.visible!==!0&&(b.show(),a.localStorage.set("tdShowToolbar",!0)),b.options.inviteVisible===!0?b.hideInvite():b.showInvite()}):(a.addClass(b.elements.share,"td_invisible"),a.addListener("click",b.elements.share,function(a){a.preventDefault(),a.stopPropagation()}))}),a.dataStorage.MarkedDomItems.regCb("add","remove","init",b.showIssueCount)}(window.TrackDuck),function(a){function b(b){var c=a.util.addElement({tag:"span",className:"td_comment_tech td_comment_extra_item",html:a.templates.comment_tech}),d=a.util.attachElements(c);return d.task.textContent="Task #"+b.number,d.task.href=a.url.dashboard+"/#/project/"+a.pId+"/issue/"+b._id,d.task.setAttribute("title","Link to dashboard"),d.txtWas.textContent="was added",d.ua.textContent=b.ua.family+" "+b.ua.major,d.ua.setAttribute("title",b.userAgent),d.os.textContent="on "+b.os.family+(b.os.major?" "+b.os.major:""),d.screen.textContent=b.data.area.screen.width+"x"+b.data.area.screen.height,d.screen.setAttribute("title","Browser size:"+b.data.area.screen.width+"x"+b.data.area.screen.height+". Screen size:"+b.data.area.resolution.width+"x"+b.data.area.resolution.height),c}function c(b,c){if(a.config.customStatuses){var d=c.integrationData[a.config.customStatuses.type];if(d.url&&d.title){var e=a.util.addElement({tag:"a",className:"td_issue_integration_link"});e.textContent=a.config.customStatuses.type.toUpperCase()+": "+d.title,e.setAttribute("target","_blank"),e.setAttribute("href",d.url),b.appendChild(e)}}}function d(b){var c=a.util.addElement({tag:"a",className:"td_comment_extra_item"});if(c.href=b.url,c.target="_blank",/image|text/.test(b.mimeType)===!1&&(c.download=b.name),"screenshot"===b.type){var d=a.util.addElement({tag:"span",className:"td_comment_extra_image"});d.style.backgroundImage="url('"+b.imageUrl+"')",c.appendChild(d),c.appendChild(a.util.addElement({tag:"span",className:"td_comment_extra_image_text",html:"Screenshot attached<br /> <strong>View in a new window</strong>"})),c.appendChild(a.util.addElement({tag:"br",className:"td_clear"}))}else"user-file"===b.type&&c.appendChild(a.util.addElement({className:"td_add_comment_file_ico",tag:"span",html:"File <strong>"+b.name+"</strong> attached"}));return c}var e=a.ClassFactory("BugWindow");e.prototype.init=function(){this.vars={},this.vars.textareaText=a.t("WRITE_COMMENT"),this.vars.attachments=[],this.initHtml(),this.setTexts(),this.bindHandlers(),this.visible=!1},e.prototype.validate=function(){return!0},e.prototype.bindHandlers=function(){function b(b){"blur"===b.type&&""===this.value?(this.value=e.vars.textareaText,a.removeClass(e.elements.addCommentBtn,"active")):"focus"===b.type&&this.value===e.vars.textareaText?(this.value="",a.removeClass(e.elements.addCommentBtn,"active")):"paste"===b.type?this.value=this.value.replace(e.vars.textareaText,""):"keydown"===b.type&&(a.addClass(e.elements.addCommentBtn,"active"),this.value===e.vars.textareaText&&(this.value=""))}function c(b){if(!("keypress"===b.type&&13!==b.keyCode||"keypress"===b.type&&(b.shiftKey||b.ctrlKey||b.altKey))){if(b.preventDefault(),"click"===b.type&&b.stopPropagation(),!e.validate())return void(e.elements.emailError.style.display="block");e.elements.textarea.value===e.vars.textareaText&&(e.elements.textarea.value=" "),e.storedItem.save(e,e.vars.attachments),e.elements.addCommentExtra.textContent="",e.elements.attachFileInput.value="",e.vars.attachments=[],a.event.fire("click.new.task")}}function d(b){("keypress"!==b.type||13===b.keyCode)&&("keypress"===b.type&&(b.shiftKey||b.ctrlKey||b.altKey)||(b.preventDefault(),"click"===b.type&&b.stopPropagation(),""!==e.elements.textarea.value&&e.elements.textarea.value!==e.vars.textareaText||e.vars.attachments.length?(e.elements.textarea.value===e.vars.textareaText&&(e.elements.textarea.value=""),e.storedItem.comment(e.elements.textarea.value,e.vars.attachments),e.elements.textarea.value=e.vars.textareaText,e.elements.textarea.blur(),a.util.textAreaAutoSize({target:e.elements.textarea}),e.elements.addCommentExtra.textContent="",e.elements.attachFileInput.value="",e.vars.attachments=[]):(a.addClass(e.elements.textarea,"td_comment_error"),setTimeout(function(){a.removeClass(e.elements.textarea,"td_comment_error")},500))))}var e=this;switch(a.addListener("keyup",this.elements.textarea,a.util.textAreaAutoSize),a.addListener("keyup",this.elements.textarea,this.setContainerPosition.bind(this)),a.addListener("focus",this.elements.textarea,b),a.addListener("blur",this.elements.textarea,b),a.addListener("paste",this.elements.textarea,b),a.addListener("keydown",this.elements.textarea,b),this.elements.priority&&a.addListener("click",this.elements.priority,function(){a.toggleClass(this,"td_active"),e.elements.priorityInput.value="1"===e.elements.priorityInput.value?"0":"1","edit"===e.issueType&&e.storedItem.save(e)}),this.elements.status&&a.addListener("click",this.elements.status,function(){a.toggleClass(this,"td_active"),e.elements.statusInput.value="0"===e.elements.statusInput.value?"30":"0","edit"===e.issueType&&e.storedItem.save(e)}),this.elements.customStatusesSelect&&a.addListener("change",this.elements.customStatusesSelect,function(){"edit"===e.issueType&&e.storedItem.save(e)}),this.elements.attachScreenShot&&a.addListener("click",this.elements.attachScreenShot,function(b){b.preventDefault(),e.elements.root.style.display="none",a.API.startSelectArea(function(b){e.elements.root.style.display="block",a.popup.show(!1),e.vars.attachments.push({type:"screenshot",mimeType:"image/jpeg",url:b,imageUrl:a.url.imageCDN+b.split("/").pop()}),e.elements.addCommentExtra.appendChild(a.util.addElement({tag:"span",html:"Screenshot attached."}))},function(){e.elements.root.style.display="block",a.popup.show(!1)})}),this.elements.attachFile&&a.addListener("change",this.elements.attachFile,function(b){function c(c,d,h,i){200===d&&(e.vars.attachments.push({type:"user-file",mimeType:c.type,url:i,name:c.name}),e.elements.addCommentExtra.appendChild(a.util.addElement({tag:"span",html:"File "+c.name+" attached."}))),++f===b.target.files.length&&(e.elements.addCommentBtn.textContent=g)}if(0!==b.target.files.length){var d,f=0,g=e.elements.addCommentBtn.textContent;e.elements.addCommentBtn.textContent="Uploading...";for(var h=0;h<b.target.files.length;h++)d=b.target.files[h],a.uploadToCDN.userFile(d,c.bind(this,d))}}),this.issueType){case"new":case"anon":a.addListener("click",this.elements.addCommentBtn,c),a.addListener("keypress",this.elements.textarea,c);break;case"edit":a.addListener("click",this.elements.addCommentBtn,d),a.addListener("keypress",this.elements.textarea,d)}},e.prototype.attach=function(b,c,d){var e=this;this.position=b,this.data=c,this.storedItem=d,this.vars.attachments=[],this.bindData(c),a.userHaveRole("Contributor")||a.addClass(this.elements.root,"td_reporter_view"),window.QuablerReadOnlyMode===!0&&a.addClass(this.elements.root,"td_readonly_view"),this.elements.root.style.display="block",this.elements.issueContainer.style.display="block",this.elements.emailError.style.display="",this.visible=!0,this.setRootPosition(),"edit"===this.issueType?this.setScreenShot():a.event.register("resized_selected_outline",function(){e.setContainerPosition()}),this.setContainerPosition(),"edit"!==this.issueType||a.dataStorage.MarkedDomItems.selected&&a.dataStorage.MarkedDomItems.selected._id===c._id||(a.dataStorage.IssueComments.clear(),a.dataStorage.MarkedDomItems.select(c)),this.elements.textarea.setAttribute("placeholder",this.vars.textareaText),a.util.isElementVisibleInScreen(this.elements.textarea)&&a.domain.isMobileDevice===!1?(this.elements.textarea.focus(),setTimeout(function(){e.elements.textarea.value=e.vars.textareaText,a.util.setElementCursorPosition(e.elements.textarea),a.util.textAreaAutoSize({target:e.elements.textarea})},80)):(this.elements.textarea.value=this.vars.textareaText,a.util.textAreaAutoSize({target:this.elements.textarea})),a.event.fire("open.task.ui",this.data)},e.prototype.deatach=function(){this.elements.root.style.display="none",this.elements.root.style.backgroundImage="",this.elements.issueContainer.style.display="","image/gif"===this.position.mediaType&&(this.elements.videoCont.style.display="",a.removeClass(document.body,"td_overflow_hidden")),this.elements.traingle.style.left="",a.removeClass(this.elements.traingle,"td_triangle_big"),a.removeClass(this.elements.root,"td_issue_container_left"),this.visible=!1,a.event.fire("close.task.ui",this.data)},e.prototype.setRootPosition=function(){if("image/gif"===this.position.mediaType)this.elements.videoCont.style.display="block",a.addClass(document.body,"td_overflow_hidden");else if("edit"===this.issueType){var b=a.getMarkerPosition(this.position);this.elements.root.style.top=b.y-this.position.height+"px",this.elements.root.style.left=b.x+"px"}},e.prototype.setContainerPosition=function(){if(this.visible!==!1&&"image/gif"!==this.position.mediaType){var b={left:this.elements.root.offsetLeft,top:this.elements.root.offsetTop,width:this.elements.root.offsetWidth,height:this.elements.root.offsetHeight},c=370,d=this.elements.issueContainer.offsetHeight;if((a.hasClass(this.elements.root,"td_issue_container_right")||a.hasClass(this.elements.root,"td_issue_container_left"))&&a.hasClass(this.elements.root,"td_issue_container_top")===!1&&(d+=12),2*c>window.innerWidth){c=window.innerWidth,a.addClass(this.elements.root,"td_issue_container_mobile");var e=Math.max(0,b.left-window.pageXOffset+c-window.innerWidth);return this.elements.issueContainer.style.left=-1*e+"px",this.elements.traingle.style.left=e+15+"px",void(this.elements.issueContainer.style.width=window.innerWidth+"px")}a.removeClass(this.elements.root,"td_issue_container_mobile"),this.elements.issueContainer.style.left="",this.elements.traingle.style.left="",this.elements.issueContainer.style.width="";var f=b.top-parent.pageYOffset,g=parent.pageYOffset+parent.innerHeight-(b.top+b.height);f>g&&f>d+20?(a.addClass(this.elements.root,"td_issue_container_top"),this.elements.traingle.style.top=d+"px"):(a.removeClass(this.elements.root,"td_issue_container_top"),this.elements.traingle.style.top="");var h=parent.innerWidth+parent.pageXOffset-(b.left+b.width),i=b.left-parent.pageXOffset,j=d+40>g||b.left-parent.pageXOffset+c+20>parent.innerWidth;j&&i>h&&i>c+20?(a.addClass(this.elements.root,"td_issue_container_left"),a.removeClass(this.elements.root,"td_issue_container_right")):j&&h>c+20?(a.addClass(this.elements.root,"td_issue_container_right"),a.removeClass(this.elements.root,"td_issue_container_left")):(a.removeClass(this.elements.root,"td_issue_container_left"),a.removeClass(this.elements.root,"td_issue_container_right")),a.util.getDocumentHeight(window)>a.util.getDocumentHeight(parent)&&(a.frame.getElement().style.height=a.util.getDocumentHeight(window)+"px")}},e.prototype.getData=function(){var b={assigneeContributor:this.elements.assignee.querySelector("select").value||null,status:this.elements.statusInput.value,description:"edit"===this.issueType?this.elements.hiddenDescription.value:this.elements.textarea.value,priority:this.elements.priorityInput.value};return this.vars.isCustomStatuses&&(b.tempInt={type:a.config.customStatuses.type,value:this.elements.customStatusesSelect.value}),b},e.prototype.bindData=function(b){var c=this;if(0!==+b.priority?(this.elements.priorityInput.value=1,a.addClass(this.elements.priority,"td_active")):(this.elements.priorityInput.value=0,a.removeClass(this.elements.priority,"td_active")),30==b.status?(this.elements.statusInput.value=30,a.addClass(this.elements.status,"td_active")):(this.elements.statusInput.value=0,a.removeClass(this.elements.status,"td_active")),this.vars.isCustomStatuses&&b.integrationData){var d=a.config.customStatuses.type,e="jira"===d?b.integrationData.jira.transitions:a.config.customStatuses.list;this.elements.customStatusesSelect.innerHTML="";for(var f=0;f<e.length;f++){var g=document.createElement("option");g.text=e[f].name,g.setAttribute("value",e[f].id),e[f].id===b.integrationData[d].status&&g.setAttribute("selected",""),this.elements.customStatusesSelect.appendChild(g)}e.length&&(this.elements.customStatuses.style.display="block")}var h,i=a.map(a.dataStorage.Contributors.data,function(a){return 20!==a.status&&30!==a.role?{_id:a._id,name:a.name}:void 0});if(h="new"===c.issueType?a.getContributorById(b.assigneeContributor||a.defaultAssignee):a.getContributorById(b.assigneeContributor,null,{_id:0,name:"---",gravatar:"default"}),a.util.arrayToSelect(this.elements.assigneeHolder,i,{firstEmpty:!0,selected:h._id}),this.elements.assigneeGhost.textContent=h.name,this.elements.avatarImg.src="//gravatar.com/avatar/"+h.gravatar+"?s=36&d=mm","edit"===this.issueType){var j={contributor:b.createdByContributor,date:b.createdOn,messageHtml:b.descriptionHtml,attachments:b.attachments,createdByName:b.createdByName};this.elements.descriptionContainer.innerHTML="",this.elements.descriptionContainer.appendChild(this.createCommentHtml(j,!1,!0)),this.elements.hiddenDescription.value=b.description}this.elements.textarea.value=a.variables.tempComment||this.vars.textareaText,delete a.variables.tempComment,a.removeClass(this.elements.addCommentBtn,"active"),a.addListener("change",this.elements.assignee.querySelector("select"),function(){c.elements.assigneeGhost.textContent=a.getContributorById(this.value,"name","---"),c.elements.avatarImg.setAttribute("src","//gravatar.com/avatar/"+a.getContributorById(this.value,"gravatar","default")+"?s=34&d=mm"),"edit"===c.issueType&&c.storedItem.save(c)})},e.prototype.createCommentHtml=function(e,f,g){var h=a.util.addElement({className:"td_comment",html:a.templates.task_comment});h.setAttribute("data-trackduck-comment-id",e._id),f&&(h.style.display="none");var i=a.util.attachElements(h);if(i.avatar.src="//gravatar.com/avatar/"+a.getContributorById(e.contributor,"gravatar","default")+"?s=36&d=mm",i.commentBy.textContent=a.getContributorById(e.contributor,"name",e.createdByName||a.t("ANONYMOUS")),i.time.setAttribute("title",a.formatDate.full(e.date)),i.time.textContent=" "+a.formatDate.nice(e.date),i.text.innerHTML=e.messageHtml,g&&(i.commentExtra.style.display="block",i.commentExtra.appendChild(b(this.data)),c(i.commentExtra,this.data)),e.attachments&&e.attachments.length){i.commentExtra.style.display="block";for(var j=0;j<e.attachments.length;j++)e.attachments[j].isPrimary||i.commentExtra.appendChild(d(e.attachments[j]))}if(g||e.contributor===a.getCurrentContributor()._id){i.remove.setAttribute("title","Delete permanently");var k=this;a.addListener("click",i.remove,function(b){b.preventDefault();var c=window.confirm(a.t("DELETE_CONFIRM"));c&&g?(k.storedItem.pageMarker.hideIssueWindow(),k.storedItem.setRemoved(k)):c&&k.storedItem.deleteComment(e._id)})}else i.remove.style.display="none";return h},e.prototype.moreCommentsHtml=function(b){var c='<div class="td_hidden_comments_btn"><span>'+parseInt(b,10)+"</span> "+a.t("HIDDEN_COMMENTS")+"</div>";return a.util.addElement({className:"td_hidden_comments",html:c})},e.prototype.setScreenShot=function(){var b=a.base64Images[this.position.scr.url]||a.vars.videoBlobsUrls[this.position.scr.url]||this.position.scr.url;this.elements.root.style.backgroundImage=b?"url("+b+")":"none",this.elements.root.style.width=this.position.width+"px",this.elements.root.style.height=this.position.height+"px"},e.prototype.getSharingLoginHtml=function(){var b=document.createElement("div");b.className="td_sharing_login";var c=document.createElement("a");return c.setAttribute("href","#"),c.textContent=a.t("LOGIN_TO_COMMENT"),a.addListener("click",c,function(b){b.preventDefault(),a.domain.openAuthWindow("login",location.reload.bind(location))}),b.appendChild(c),b},e.prototype.setTexts=function(){this.elements.assignedText.textContent=a.t("ASSIGNED_TO"),this.elements.status.setAttribute("title","Mark as done"),this.elements.priority.setAttribute("title","Mark as priority"),this.elements.emailError.textContent="Email is required and have to be valid!",this.elements.addCommentHelp.textContent=a.t("ENTER_SUBMIT"),this.elements.addCommentBtn.textContent=a.t("SEND")},e.prototype.processCustomStatuses=function(){if(a.config.customStatuses){var b=this.elements;this.vars.isCustomStatuses=!0,a.addClass(b.head,"td_issue_yes_custom_statuses"),b.status.style.display="none",b.customStatusesTitle.textContent=a.t("TASK_STATUS")}};var f=a.ClassFactory("BugEditWindow","BugWindow");f.prototype.issueType="edit",f.prototype.initHtml=function(){var b=a.util.addElement({className:"td_issue_edit",index:5,html:a.templates.task_ui}),c=a.util.attachElements(b);!a.user&&a.projectSharing&&(c.issueContainer.appendChild(this.getSharingLoginHtml()),a.addClass(c.issueContainer,"td_readonly_view")),document.body.appendChild(b),this.elements=c,this.elements.root=b,this.processCustomStatuses()},a.ui.editBugWindow=new f;var g=a.ClassFactory("BugNewWindow","BugWindow");g.prototype.issueType="new",g.prototype.initHtml=function(){var b=a.util.addElement({className:"td_issue_new",index:5,html:a.templates.task_ui}),c=a.util.attachElements(b);c.commentsContainer.style.display="none",document.body.appendChild(b),this.elements=c,this.elements.root=b,this.processCustomStatuses()},a.ui.newBugWindow=new g;var h=a.ClassFactory("BugAnonWindow","BugWindow");h.prototype.issueType="anon",h.prototype.validate=function(){if(!a.barConfig.isEmailRequired)return!0;var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,c=b.test(this.elements.anonEmail.value);return c?a.removeClass(this.elements.anonEmail,"error"):a.addClass(this.elements.anonEmail,"error"),c},h.prototype.initHtml=function(){var b=a.util.addElement({className:"td_issue_anon",index:5,html:a.templates.task_ui}),c=a.util.attachElements(b);b.style.borderColor=a.barConfig.backgroundColor,c.commentsContainer.style.display="none",c.issueContainer.style.borderColor=a.barConfig.backgroundColor,c.anonEmail.value=a.util.htmlEntities(a.localStorage.get("tdAnonymousEmail")||""),c.anonEmail.setAttribute("placeholder",a.t("EMAIL")+(a.barConfig.isEmailRequired?"":" "+a.t("OPTIONAL"))),c.anonEmail.style.display="block",c.head.style.display="none",a.barConfig.isAttachmentEnabled===!1&&(c.attachmentsContainter.style.display="none"),document.body.appendChild(b),this.elements=c,this.elements.root=b},h.prototype.bindData=function(){},h.prototype.getData=function(){return a.localStorage.set("tdAnonymousEmail",this.elements.anonEmail.value),{description:this.elements.textarea.value,reporterEmail:this.elements.anonEmail.value,assigneeContributor:a.defaultAssignee}},a.ui.newAnonWindow=new h;var i=a.ClassFactory("BugVideoNewWindow","BugNewWindow");i.prototype.initHtml=function(){var b=a.util.addElement({className:"td_issue_new td_video_issue",index:5,html:a.templates.task_ui}),c=a.util.attachElements(b);c.commentsContainer.style.display="none",c.addCommentBtn.textContent=a.t("SAVE_CAPTURE"),this.elements=c,this.elements.root=b;var d=a.util.addElement({className:"td_video_cont",index:5});return this.elements.videoCont=document.body.appendChild(d),this.elements.videoOverflow=d.appendChild(a.util.addElement({className:"td_video_overflow"})),d.appendChild(b)
},a.ui.newBugVideoWindow=new i;var j=a.ClassFactory("BugVideoEditWindow","BugEditWindow");j.prototype.initHtml=function(){var b=a.util.addElement({className:"td_issue_edit td_video_issue",index:5,html:a.templates.task_ui}),c=a.util.attachElements(b);c.commentsContainer.style.display="none",c.addCommentBtn.textContent=a.t("SAVE"),!a.user&&a.projectSharing&&(c.issueContainer.appendChild(this.getSharingLoginHtml()),a.addClass(c.issueContainer,"td_readonly_view")),this.elements=c,this.elements.root=b;var d=a.util.addElement({className:"td_video_cont",index:5});return this.elements.videoCont=document.body.appendChild(d),this.elements.videoOverflow=d.appendChild(a.util.addElement({className:"td_video_overflow"})),d.appendChild(b)},a.ui.editBugVideoWindow=new j,a.ui.tooltipWindow=new function(){var b=this;return this.init=function(){var c=document.createElement("div");c.id="trackduck_tooltip",c.style.cssText="position:absolute !important; width:277px !important;margin:16px 0 0 -13px !important;overflow:visible !important;font-size:14px !important;color:#646c84 !important;display:none !important;z-index:"+(a.util.topZIndex+1)+" !important;";var d=document.createElement("div");c.appendChild(d),d.style.cssText="background:#ffffff !important;box-shadow:1px 1px 4px 0 rgba(0, 0, 0, 0.5) !important;overflow:visible !important;word-wrap:break-word !important;";var e=document.createElement("div");e.style.cssText="padding:14px !important; font-size:14px !important; overflow:visible !important; line-height:14px !important; text-align:left !important;",b.contentElement=d.appendChild(e);var f=document.createElement("div");b.commentElement=d.appendChild(f),b.element=a.rootElement.appendChild(c)},this.attach=function(b,c){a.ui.editBugWindow.visible||(this.visible=!0,this.pos=a.getMarkerPosition(b),this.commentElement.innerHTML="",this.commentElement.style.cssText="",this.contentElement.innerHTML=c.descriptionHtml,this.issueId=c._id,a.dataStorage.MarkedDomItems.select(c),this.setPosition())},this.setPosition=function(){if(this.visible===!0){a.util.setStyleImportant(this.element,"display","none");var b=a.util.getDocumentWidth(),c=a.util.getDocumentHeight();a.util.setStyleImportant(this.element,"display","block");var d=this.pos.x,e=this.pos.y;b<this.pos.x+277&&this.pos.x>277&&(d-=248),this.pos.y+this.element.offsetHeight>c&&(e-=this.element.offsetHeight+38),a.util.setStyleImportant(this.element,"top",e+"px"),a.util.setStyleImportant(this.element,"left",d+"px")}},this.deatach=function(){a.util.setStyleImportant(b.element,"display","none"),this.visible=!1},this.setComment=function(b){this.commentElement.innerHTML="",this.commentElement.style.cssText="padding:14px !important; border-top: 1px solid #dde3ec !important;overflow:visible !important; text-align:left !important;";var c=document.createElement("div");c.style.cssText="font-weight:bold !important; overflow:visible !important;",c.textContent=a.getContributorById(b.contributor,"name",a.t("ANONYMOUS")),this.commentElement.appendChild(c);var d=document.createElement("div");d.style.cssText="",d.innerHTML=b.messageHtml,this.commentElement.appendChild(d)},this};var k=function(){var a={};return function(b){return a[b]?a[b]:a[b]=b?parent.document.querySelector(b):null}}();a.getMarkerPosition=function(b){var c,d,e=k(b.relative.element);if(e){var f=e.getBoundingClientRect();if(d=Math.max(b.height,f.top+a.util.getDocumentScrollXY().y+b.relative.y),c=Math.max(0,f.left+a.util.getDocumentScrollXY().x+b.relative.x),f.width&&d<=a.util.getDocumentHeight()&&c<=a.util.getDocumentWidth())return{y:d,x:c}}var g=parent.window.innerWidth/b.screen.width;return c=b.x*g,d=b.y,{y:d,x:c}},a.dataStorage.IssueComments.regCb("add",function(b){var c=a.ui.editBugWindow,d=a.ui.editBugVideoWindow;c.data&&c.data._id===b.issue&&(c.elements.commentsContainer.appendChild(c.createCommentHtml(b,!1,!1)),c.setContainerPosition()),d.data&&d.data._id===b.issue&&d.elements.commentsContainer.appendChild(d.createCommentHtml(b,!1,!1)),a.ui.tooltipWindow.issueId===b.issue&&(a.ui.tooltipWindow.setComment(b),a.ui.tooltipWindow.setPosition())}),a.dataStorage.IssueComments.regCb("init",function(b){var c=a.ui.editBugWindow,d=a.ui.editBugVideoWindow,e=c.elements.commentsContainer,f=d.elements.commentsContainer;e.innerHTML="",f.innerHTML="";var g=a.dataStorage.IssueComments.count(),h=0,i=null,j=function(){for(var a=0;a<this.parentNode.children.length;a++)this.parentNode.children[a].style.display="block";this.parentNode.removeChild(this),c.setContainerPosition()};for(var k in b){if(i=b[k],g>2&&h===g-2){var l=c.moreCommentsHtml(g-2),m=c.moreCommentsHtml(g-2);a.addListener("click",l,j),a.addListener("click",m,j),e.appendChild(l),f.appendChild(m)}var n=!!(g>2&&g-3>=h);e.appendChild(c.createCommentHtml(i,n,!1)),f.appendChild(d.createCommentHtml(i,n,!1)),h++}i&&a.ui.tooltipWindow.issueId===i.issue&&(a.ui.tooltipWindow.setComment(i),a.ui.tooltipWindow.setPosition()),c.position&&c.setContainerPosition()}),a.dataStorage.IssueComments.regCb("delete",function(b){var c=a.ui.editBugWindow,d=a.ui.editBugVideoWindow;if(c.data&&b&&c.data._id===b.issue){var e=c.elements.commentsContainer.querySelector("[data-trackduck-comment-id='"+b._id+"']");e&&(c.elements.commentsContainer.removeChild(e),c.setContainerPosition())}if(d.data&&d.data._id===b.issue){var e=d.elements.commentsContainer.querySelector("[data-trackduck-comment-id='"+b._id+"']");e&&d.elements.commentsContainer.removeChild(e)}}),a.dataStorage.MarkedDomItems.regCb("update",function(b){var c=a.ui.editBugWindow;c.data&&c.data._id===b._id&&c.bindData(b)}),a.dataStorage.MarkedDomItems.regCb("select",function(){a.WebService("getIssueComments")}),a.dataStorage.MarkedDomItems.regCb("unSelect",function(){a.dataStorage.IssueComments.clear()})}(window.TrackDuck),function(a){var b=function(b){var c=this;this.marker=b,this.data=b.data,this.position=this.data.data.area,this.placeInside=!1;var d=document.createElement("div");this.element=d,this.childElement=this.element.appendChild(document.createElement("div")),a.addListener("click",d,function(){c.showIssueWindow.call(c)}),a.addListener("mouseenter",d,function(){c.update(),a.ui.tooltipWindow.attach(c.position,c.data)}),a.addListener("mouseleave",d,function(){a.ui.tooltipWindow.deatach()}),"image/gif"===this.position.mediaType&&(this.element.style.visibility="hidden"),this.element.style.cssText="position:absolute !important; box-shadow:0px 0px 4px rgba(0, 0, 0, 0.4) !important; padding:0 !important; margin:0 !important; width:30px !important; display:block !important; height:30px !important; border-radius:30px; !important; overflow:visible !important;cursor:pointer !important; transition: 0.123s ease-in all !important;z-index:"+(a.util.topZIndex+1)+" !important;",this.childElement.style.cssText="position:absolute !important; border-radius: 24px !important; top:5px !important; left:5px !important; width:20px !important; height:20px !important; background-color:#ffffff !important; display:block !important; background-repeat:no-repeat !important; overflow:visible !important;",this.update(),a.markersContainerElement.appendChild(this.element)};b.prototype.update=function(){a.util.setStyleImportant(this.element,"top",a.getMarkerPosition(this.position).y-17+"px"),a.util.setStyleImportant(this.element,"left",a.getMarkerPosition(this.position).x-13+"px"),0!==+this.data.priority?a.util.setStyleImportant(this.childElement,"background-image","url('"+a.config.assetsRoot+"img/td-anon.png')"):a.util.setStyleImportant(this.childElement,"background-image","none"),3===this.data.status||30===this.data.status?(a.util.setStyleImportant(this.element,"background","#afca52"),a.util.setStyleImportant(this.childElement,"background-position","-19px 2px")):(a.util.setStyleImportant(this.element,"background","#ffad4d"),a.util.setStyleImportant(this.childElement,"background-position","3px 2px"))},b.prototype.remove=function(){this.element.parentNode.removeChild(this.element)},b.prototype.showIssueWindow=function(){var b=this;if(null===a.dataStorage.MarkedDomItems.selected&&a.dataStorage.MarkedDomItems.select(this.data),a.ui.tooltipWindow.deatach(),"image/gif"===this.position.mediaType)a.addListener("click",a.ui.editBugVideoWindow.elements.videoOverflow,function d(){a.removeListener("click",a.ui.editBugVideoWindow.elements.videoOverflow,d),b.hideIssueWindow.call(b)});else{a.popup.show(!1),a.popup.setDimensions(a.getMarkerPosition(b.position).x,a.getMarkerPosition(b.position).y-b.position.height,b.position.width,b.position.height),a.events.overlayDimensions=function(){a.popup.setDimensions(a.popup.dimensions.x,a.popup.dimensions.y,a.popup.dimensions.w,a.popup.dimensions.h)},a.addListener("scroll",document,a.events.overlayDimensions),a.addListener("resize",window,a.events.overlayDimensions);var c=function(d){("click"===d.type||"keydown"===d.type&&27===d.keyCode)&&(b.hideIssueWindow.call(b),a.removeListener("click",a.popup.overlay,c),a.removeListener("keydown",window,c))};a.addListener("click",a.popup.overlay,c),a.addListener("keydown",window,c),window.focus()}a.util.setStyleImportant(this.element,"z-index",a.util.topZIndex+6),"image/gif"===this.position.mediaType?a.ui.editBugVideoWindow.attach(this.position,this.data,this.marker):a.ui.editBugWindow.attach(this.position,this.data,this.marker)},b.prototype.hideIssueWindow=function(){a.popup.hide(),a.util.setStyleImportant(this.element,"z-index",a.util.topZIndex),"image/gif"===this.position.mediaType?a.ui.editBugVideoWindow.deatach():a.ui.editBugWindow.deatach(),a.dataStorage.MarkedDomItems.unSelect(),a.removeListener("scroll",document,a.events.overlayDimensions),a.removeListener("resize",window,a.events.overlayDimensions)},b.prototype.highlite=function(){},b.prototype.scrollTo=function(){var b=this,c=this.element.getBoundingClientRect().top+a.util.getDocumentScrollXY().y,d=c-window.innerHeight/2;a.scrollTop(d,300,function(){b.highlite()})},b.prototype.scrollToTop=function(){var b=a.getMarkerPosition(this.data.data.area).y-this.data.data.area.height;a.scrollTop(b,0)},a.PageMarker=b}(window.TrackDuck),function(a){function b(b,c){function d(b){var c=l(a.pId,a.variables.scArea);a.variables.scCallback(a.url.imageCDN+c,b),a.sendImageToServer(b,c,a.getMediaMetadata(a.variables.scArea)),a.variables.scArea=null,a.variables.scCallback=null}if("td_firefox_screenshot_taken"===b)d(c);else if("td_chrome_screenshot_taken"===b||"td_safari_screenshot_taken"===b){var e=window.devicePixelRatio||1,f=a.variables.scArea,g=f.x-a.util.getDocumentScrollXY().x,h=f.y-a.util.getDocumentScrollXY().y-f.height;if(g=0>g?0:g,h=0>h?0:h,window.parent.frameElement){var k=window.parent.frameElement.getBoundingClientRect();g+=k.left,h+=k.top}i(c,1/e,function(a){j(a,f.width,f.height,g,h,d)})}}function c(b,c,g){var h=b.cloneNode(!0);if(!h.children[0].querySelector("head")){var i=b.ownerDocument.createElement("base");i.setAttribute("href",g),h.children[0].insertBefore(i,h.children[0].firstChild)}f(h,b,c),d(h.getElementsByTagName("script")),d([h.querySelector("#trackduck")]),e(b,h);var j=h.children[0].appendChild(b.ownerDocument.createElement("script"));j.textContent="function tdFrameLoad(frame, i) { var tp = document.querySelector('[td-template-'+i+']').textContent.replace(/&lt;/g, '<').replace(/&gt;/g, '>');var doc = (new DOMParser()).parseFromString(tp, 'text/html');frame.contentWindow.document.replaceChild(doc.documentElement, frame.contentWindow.document.documentElement); }";for(var k=h.getElementsByTagName("iframe"),l=b.getElementsByTagName("iframe"),m=0,n=k.length;n>m;m++)if(a.util.isSameOrigin(parent.location.href,k[m].src)){k[m].removeAttribute("src"),k[m].setAttribute("onload","top.tdFrameLoad(this, "+m+");");var o=l[m].contentWindow.document.documentElement.cloneNode(!0);d(o.getElementsByTagName("script")),e(l[m].contentWindow.document.documentElement,o);var p=h.children[0].appendChild(b.ownerDocument.createElement("script"));p.type="text/td-template",p.setAttribute("td-template-"+m,""),p.textContent=o.outerHTML.replace(/</g,"&lt;").replace(/>/g,"&gt;")}return h.outerHTML}function d(a){for(var b=a.length,c=b-1;c>=0;c--)a[c].parentElement.removeChild(a[c])}function e(b,c){for(var d=b.querySelectorAll("canvas"),e=c.querySelectorAll("canvas"),f=0,g=d.length;g>f;f++){var h=new Image;try{h.src=d[f].toDataURL()}catch(i){a.log("replaceCanvasToImg fail",i)}h.setAttribute("onload","this.parentNode.getContext('2d').drawImage(this, 0, 0)"),e[f].appendChild(h)}}function f(b,c,d){for(var e,f,g,h,i=b.getElementsByTagName("img"),j=c.getElementsByTagName("img"),k="data:image/gif;base64,R0lGODlhAQABAHAAACH5BAUAAAAALAAAAAABAAEAAAICRAEAOw==",l=a.util.getDocumentScrollXY(),m=0,n=j.length;n>m;m++)e=j[m].getBoundingClientRect(),f=parent.getComputedStyle(j[m]),g=d.y-d.height<e.bottom+l.y&&d.y>e.top+l.y,h=d.x<e.right+l.x&&d.x+d.width>e.left+l.x,(g===!1||h===!1)&&(i[m].src=k,i[m].style.width=f.width,i[m].style.height=f.height)}function g(){return parent.document.doctype?"<!DOCTYPE "+parent.document.doctype.name+(parent.document.doctype.publicId?' PUBLIC "'+parent.document.doctype.publicId+'"':"")+(parent.document.doctype.systemId?' "'+parent.document.doctype.systemId+'"':"")+">":""}function h(b,c,d){var e=document.createElement("canvas");e.height=b.height,e.width=b.width;var f=e.getContext("2d");f.rect(0,0,b.width,b.height),f.fillStyle="#ffffff",f.fill(),f.drawImage(c,b.x,b.y-b.height,b.width,b.height,0,0,b.width,b.height);var g=null;try{g=e.toDataURL()}catch(h){a.error("html2canvas fail toDataURL",{name:h.name,message:h.message}),g="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}d(g)}function i(a,b,c){if(1===b)c(a);else{var d=new Image;d.onload=function(){if(d.width===parent.innerWidth&&d.height===parent.innerHeight)return void c(a);var e=document.createElement("canvas");e.width=d.width*b,e.height=d.height*b;var f=e.getContext("2d");f.scale(b,b),f.drawImage(d,0,0),c(e.toDataURL())},d.src=a}}function j(a,b,c,d,e,f){var g=new Image;g.onload=function(){b=b>g.width?g.width:b,c=c>g.height?g.height:c;var a=document.createElement("canvas");a.width=b,a.height=c;var h=a.getContext("2d");h.drawImage(g,d,e,b,c,0,0,b,c),f(a.toDataURL())},g.src=a}function k(a,b,c,d,e){var f=URL.createObjectURL(a),g=document.createElement("video");g.setAttribute("autoplay",!0),g.setAttribute("width",b),g.setAttribute("height",c),g.oncanplay=function(){var a=document.createElement("canvas");a.width=d.width,a.height=d.height;var b=a.getContext("2d");b.drawImage(g,d.x,d.y,d.width,d.height,0,0,d.width,d.height),e(a.toDataURL())},g.src=f}function l(b,c){return a.domain.getWebSiteId()+"-"+(new Date).getTime()+"-"+c.width+"-"+c.height+".jpg"}function m(b){return a.util.waitForFinalEvent(function(){b.altKey&&b.shiftKey&&84===b.keyCode?a.debugServerSideScreenshot():b.altKey&&84===b.keyCode&&a.captureScreenShotFromMouse()},80,"screen.shot.from.key"),!1}var n=null;try{window.top.document.body&&(n=window.top)}catch(o){}n&&n.addEventListener("message",function(c){if(a.variables.scArea&&a.variables.scCallback){var d=["td_firefox_screenshot_taken","td_chrome_screenshot_taken","td_safari_screenshot_taken"];c.data&&c.data.imgUrl&&-1!==d.indexOf(c.data.type)&&(a.showEverything(),a.log("Extension screen shot taken",c.data.type),b(c.data.type,c.data.imgUrl))}}),a.screenShotCloseWarning=function(a){var b="Screenshot is processing, if you close window it will not be saved.";return(a||window.event).returnValue=b,b},a.saveScreenshotAndGetUrl=function(b,c){if(a.config.takeScreenshots!==!0||a.config.allowScreenShot===!1)c(null,null);else{a.addListener("beforeunload",parent,a.screenShotCloseWarning),parent.pageYOffset>b.y-b.height?parent.scrollTo(parent.pageXOffset,b.y-b.height):parent.pageYOffset+parent.innerHeight<b.y&&parent.scrollTo(parent.pageXOffset,b.y-parent.innerHeight),parent.pageXOffset+parent.innerWidth<b.x+b.width?parent.scrollTo(b.x+b.width-parent.innerWidth,parent.pageYOffset):parent.pageXOffset>b.x&&parent.scrollTo(b.x,parent.pageYOffset);var d=n&&n.TrackDuck&&n.TrackDuck.browserExtension;if("firefox"===d)a.variables.scArea=b,a.variables.scCallback=c,a.hideEverything(function(){var c={x:b.x,y:b.y-b.height,w:b.width,h:b.height};if(window.parent.frameElement){var d=window.parent.frameElement.getBoundingClientRect();c.x=c.x+d.left-a.util.getDocumentScrollXY().x,c.y=c.y+d.top-a.util.getDocumentScrollXY().y}n.postMessage({type:"td_firefox_screenshot_take",area:c},"*")});else if("chrome"===d)a.variables.scArea=b,a.variables.scCallback=c,a.hideEverything(function(){n.postMessage({type:"td_chrome_screenshot_take"},"*")});else if("safari"===d)parent.scrollTo(b.x-(window.innerWidth-b.width),b.y-b.height),a.variables.scArea=b,a.variables.scCallback=c,a.hideEverything(function(){n.postMessage({type:"td_safari_screenshot_take"},"*")});else if("server"===a.config.screenShotEngine||"#reph"===parent.location.hash)a.captureUsingRenderServer(b,function(d){a.showEverything();var e=l(a.pId,b);c(a.url.imageCDN+e,d),a.sendImageToServer(d,e,b)},a.log.bind(a.log,"captureUsingRenderServer fail"));else if("selenium"===a.config.screenShotEngine||"#rese"===parent.location.hash){var e=l(a.pId,b);a.captureUsingSelenium(e,b,function(){a.showEverything(),a.removeListener("beforeunload",parent,a.screenShotCloseWarning),c(a.url.imageCDN+e,a.url.imageCDN+e)},a.log.bind(a.log,"captureUsingSelenium fail"))}else a.showEverything(),a.makeFullPageScreenshot(function(d){h(b,d,function(d){var e=l(a.pId,b);c(a.url.imageCDN+e,d),a.sendImageToServer(d,e,a.getMediaMetadata(b)),parent.scrollTo(b.x+b.width+40-parent.innerWidth,b.y-b.height)})},b.x,b.y-b.height)}},a.makeFullPageScreenshot=function(b,c,d){function e(e){if(null!==i){if(e)window.clearTimeout(i);else{a.error("html2canvas was late to finish capturing"),e=document.createElement("canvas"),e.width=a.util.getDocumentWidth(),e.height=a.util.getDocumentHeight();var f=e.getContext("2d");f.font="16px serif",f.fillText("Failed to capture screenshot",c+10,d+20)}i=null,h(),b(e)}}function f(){for(var a=[parent],b=parent.document.querySelectorAll("iframe"),c=parent.location.href.split("/").splice(0,3).join("/"),d=0,e=b.length;e>d;d++)b[d].src.split("/").splice(0,3).join("/")===c&&a.push(b[d].contentWindow);return a}function g(){for(var a=f(),b=0,c=a.length;c>b;b++){var d=a[b].document.querySelectorAll(".gm-style > div:first-child > div");if(d.length){var e=d[0].style.transform;d[0].setAttribute("data-td-transform",e);for(var g=e.split(","),h=parseFloat(g[4]),i=parseFloat(g[5]),j=0,k=d.length;k>j;j++)d[j].style.transform="none",d[j].style.left=h+"px",d[j].style.top=i+"px"}}}function h(){for(var a=f(),b=0,c=a.length;c>b;b++){var d=a[b].document.querySelectorAll(".gm-style > div:first-child > div");if(d.length){var e=d[0].getAttribute("data-td-transform");d[0].removeAttribute("data-td-transform");for(var g=0,h=d.length;h>g;g++)d[g].style.transform=e,d[g].style.left="0px",d[g].style.top="0px"}}}var i=null;g(),window.html2canvas(parent.document.body,{allowTaint:!1,useCORS:!0,imageTimeout:4e3,svgRendering:!0,proxy:a.url.imageProxy,logging:!1}).then(e),i=window.setTimeout(e,a.config.html2canvasTimeout)},a.sendImageToServer=function(b,c,d){function e(b){a.addListener("readystatechange",b,function c(){if(4===b.readyState&&(a.removeListener("beforeunload",parent,a.screenShotCloseWarning),a.removeListener("readystatechange",b,c),200!==b.status)){alert("Error saving screen shot! Please try again."),a.error("Error saving base64 image",{status:b.status,response:b.response});for(var d=Object.keys(a.dataStorage.MarkedDomItems.data),e=a.getCurrentContributor()._id,f=d.length-1;f>=0;f--)if(a.dataStorage.MarkedDomItems.data[d[f]].data.createdByContributor===e){a.dataStorage.MarkedDomItems.data[d[f]].setRemoved();break}}})}d=d||"";var f=b.replace(/^data:image\/(png|jpg|gif);base64,/,"");a.WebService("getImgUrl",{data:JSON.stringify({imgName:c,crop:{scr:f},metadata:d}),beforeSend:e})},a.captureUsingUserMedia_UNUSED=function(b,c,d){if(a.util.isAvailableScreenSharing()===!1)return a.log("getUserMedia no support"),void d();if(1!==window.devicePixelRatio)return void d();var e=screen.availWidth,f=screen.availHeight,g={x:a.vars.documentX||0,y:a.vars.documentY||0,width:window.innerWidth,height:window.innerHeight},h={video:{mandatory:{chromeMediaSource:"screen",maxWidth:2*e,maxHeight:2*f,minWidth:2*e,minHeight:2*f}}};navigator.tdUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia,navigator.tdUserMedia(h,function(d){a.log("getUserMedia success"),window.scrollTo(b.x,b.y),setTimeout(function(){k(d,e,f,g,function(a){d.stop(),c(a)})},80)},function(b){a.log("getUserMedia error: ",b),d()})},a.captureUsingRenderServer=function(b,c,e){var h=parent.document.documentElement.cloneNode(!0),i=parent.getComputedStyle(parent.document.documentElement),j=parent.document.createElement("div");parent.document.body.appendChild(j);var k=parent.getComputedStyle(j);i.getPropertyValue("background-color")===k.getPropertyValue("background-color")&&(h.style.backgroundColor="#fff"),parent.document.body.removeChild(j),f(h,parent.document.documentElement,b);var l=h.querySelectorAll("#trackduck"),m=h.getElementsByTagName("script");d(l),d(m);var n=new XMLHttpRequest;n.open("post",a.url.renderHtml),n.onreadystatechange=function(){4===n.readyState&&(200===n.status?c(n.responseText):(a.error("Render html server error: "+n.status,{responseText:n.responseText}),e(n.responseText)))};var o={url:parent.location.href,html:h.outerHTML,width:parent.innerWidth,height:parent.innerHeight,userAgent:parent.navigator.userAgent,doctype:g(),area:{x:b.x,y:b.y-b.height,width:b.width,height:b.height},metadata:a.getMediaMetadata(b)};n.send(JSON.stringify(o))},a.captureUsingSelenium=function(b,d,e,f){var h={imgName:b,url:parent.location.href,auth:a.config.auth,html:c(parent.document.documentElement,d,parent.location.href),width:parent.innerWidth,height:parent.innerHeight,userAgent:parent.navigator.userAgent,doctype:g(),scroll:a.util.getDocumentScrollXY(),mouse:a.vars.mouseClient,ratio:(document.width||document.documentElement.clientWidth)/window.innerWidth,area:{x:d.x,y:d.y-d.height,width:d.width,height:d.height},metadata:a.getMediaMetadata(d)},i=new XMLHttpRequest;i.open("post",a.url.renderHtmlToImg),i.setRequestHeader("Content-Type","application/json"),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?e(JSON.parse(i.responseText),i.status,h):(a.error("Render selenium error: "+i.status,{responseText:i.responseText}),f(i.responseText,i.status)))},i.send(JSON.stringify(h))},a.addListener("keydown",parent,m),a.addListener("keydown",window,m),a.captureScreenShotFromMouse=function(){var b=400,c=300,d=Math.max(0,a.vars.mouseClient.y+a.util.getDocumentScrollXY().y-c/2),e=Math.max(0,a.vars.mouseClient.x+a.util.getDocumentScrollXY().x-b/2),f=a.ui.newBugWindow.elements.root,g={width:b,height:c,y:d+c,x:e,screen:{width:window.innerWidth,height:window.innerHeight}};a.saveScreenshotAndGetUrl(g,function(g,h){f.style.display="block",f.style.width=b+"px",f.style.height=c+"px",f.style.top=d+"px",f.style.left=e+"px",a.Drag.resizeContainer=document.createElement("div"),a.Drag.resizeContainer.className="td_outline",a.Drag.resizeContainer.style.background="0 0 no-repeat url("+h+")",f.appendChild(a.Drag.resizeContainer),a.afterOutlineSelect(),a.popup.show(!1),a.popup.setDimensions(e,d,b,c),new a.NewItem(f,a.ui.newBugWindow,"manager"),a.vars.newIssueData={imgUrl:g,base64:h}})},a.debugFullPageScreenshot=function(){var b={x:0,y:0,width:parent.innerWidth,height:parent.innerHeight};b.screen={width:parent.innerWidth,height:parent.innerHeight},a.saveScreenshotAndGetUrl(b,function(a,b){var c=new Image;c.src=b,c.style.border="2px dashed green",parent.document.body.appendChild(c)},0,0)},a.debugServerSideScreenshot=function(){var b={x:0,y:parent.innerHeight+a.util.getDocumentScrollXY().y,width:parent.innerWidth,height:parent.innerHeight};a.captureUsingSelenium("test-"+(new Date).getTime()+".jpg",b,function(a,b,c){console.log("Oil ok",a);var d=new Image;d.src=a.url,d.style.border="2px dashed green",parent.document.body.appendChild(d);var e=parent.document.createElement("textarea");e.style.width="90%",e.style.height="500px",e.value=c.html,parent.document.body.appendChild(e)},console.log.bind(console,"Selenium debug fail"))},a.getMediaMetadata=function(a){return{width:a.width,height:a.height,screen_width:a.screen.width,screen_height:a.screen.height,url:parent.location.href,page_title:parent.document.title?parent.document.title:parent.location.hostname,timestamp:(new Date).getTime()}}}(window.TrackDuck);